<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: /github/workspace/dev_area/sourcecode/kafkaopmon/apps/kafka_opmon_consumer.cxx File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c86d4bc79f792d6c7f006f9966b5d7f5.html">dev_area</a></li><li class="navelem"><a class="el" href="dir_e594a494f7a60e5bf534551500b27d35.html">sourcecode</a></li><li class="navelem"><a class="el" href="dir_8f397c838312646e06ff0bb16cadf8c2.html">kafkaopmon</a></li><li class="navelem"><a class="el" href="dir_3b761f0bee573c70dcc45269c7b99a5c.html">apps</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">kafka_opmon_consumer.cxx File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;JsonInfluxConverter.hpp&quot;</code><br />
<code>#include &quot;boost/program_options.hpp&quot;</code><br />
<code>#include &quot;cpr/cpr.h&quot;</code><br />
<code>#include &quot;curl/curl.h&quot;</code><br />
<code>#include &quot;<a class="el" href="ers_8hpp_source.html">ers/ers.hpp</a>&quot;</code><br />
<code>#include &quot;librdkafka/rdkafkacpp.h&quot;</code><br />
<code>#include &quot;nlohmann/json.hpp&quot;</code><br />
<code>#include &lt;csignal&gt;</code><br />
<code>#include &lt;cstdio&gt;</code><br />
<code>#include &lt;cstdlib&gt;</code><br />
<code>#include &lt;cstring&gt;</code><br />
<code>#include &lt;iomanip&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;regex.h&gt;</code><br />
<code>#include &lt;sstream&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;sys/time.h&gt;</code><br />
<code>#include &lt;utility&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
<code>#include &lt;memory&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for kafka_opmon_consumer.cxx:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="kafka__opmon__consumer_8cxx__incl.svg" width="3600" height="760"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="kafka__opmon__consumer_8cxx_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacedunedaq" id="r_namespacedunedaq"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedunedaq.html">dunedaq</a></td></tr>
<tr class="memdesc:namespacedunedaq"><td class="mdescLeft">&#160;</td><td class="mdescRight">Including Qt Headers. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0e95c2c6abf38c3b0f9928ce82284d81" id="r_a0e95c2c6abf38c3b0f9928ce82284d81"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedunedaq.html#a0e95c2c6abf38c3b0f9928ce82284d81">dunedaq::ERS_DECLARE_ISSUE</a> (kafkaopmon, <a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">CannotPostToDb</a>, &quot;Cannot post to <a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">Influx</a> DB : &quot;&lt;&lt; error,((std::string) <a class="el" href="namespacedunedaq.html#aeb8ed3b73cedcc8c95a21ac77ab1b712">error</a>)) ERS_DECLARE_ISSUE(kafkaopmon</td></tr>
<tr class="separator:a0e95c2c6abf38c3b0f9928ce82284d81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ca185fa8555e0671849452593f800ac" id="r_a6ca185fa8555e0671849452593f800ac"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">Cannot</a> create std::string fatal&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedunedaq.html#a6ca185fa8555e0671849452593f800ac">dunedaq::ERS_DECLARE_ISSUE</a> (kafkaopmon, <a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">CannotConsumeMessage</a>, &quot;Cannot <a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">consume</a> <a class="el" href="namespacedunedaq.html#a2f83d5dd57a92853794fd0d3ea74b882">message</a> : &quot;&lt;&lt; error,((std::string) <a class="el" href="namespacedunedaq.html#aeb8ed3b73cedcc8c95a21ac77ab1b712">error</a>)) ERS_DECLARE_ISSUE(kafkaopmon</td></tr>
<tr class="separator:a6ca185fa8555e0671849452593f800ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abea48909f8fcf1a40fe240b2efb25339" id="r_abea48909f8fcf1a40fe240b2efb25339"><td class="memItemLeft" align="right" valign="top">static int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kafka__opmon__consumer_8cxx.html#abea48909f8fcf1a40fe240b2efb25339">now</a> ()</td></tr>
<tr class="separator:abea48909f8fcf1a40fe240b2efb25339"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca7dcd4a754790886cb4b5224de2442a" id="r_aca7dcd4a754790886cb4b5224de2442a"><td class="memItemLeft" align="right" valign="top">static std::vector&lt; std::unique_ptr&lt; RdKafka::Message &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kafka__opmon__consumer_8cxx.html#aca7dcd4a754790886cb4b5224de2442a">consume_batch</a> (RdKafka::KafkaConsumer &amp;consumer, size_t batch_size, int batch_tmout)</td></tr>
<tr class="separator:aca7dcd4a754790886cb4b5224de2442a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57ca4b1e14a743206e6b557916f899ee" id="r_a57ca4b1e14a743206e6b557916f899ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kafka__opmon__consumer_8cxx.html#a57ca4b1e14a743206e6b557916f899ee">execution_command</a> (const std::string &amp;adress, const std::string &amp;cmd)</td></tr>
<tr class="separator:a57ca4b1e14a743206e6b557916f899ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b2edb9b85259bdc7e2a158fdcea8c7a" id="r_a7b2edb9b85259bdc7e2a158fdcea8c7a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kafka__opmon__consumer_8cxx.html#a7b2edb9b85259bdc7e2a158fdcea8c7a">consumerLoop</a> (RdKafka::KafkaConsumer &amp;consumer, int batch_size, int batch_tmout, std::string adress)</td></tr>
<tr class="separator:a7b2edb9b85259bdc7e2a158fdcea8c7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97" id="r_a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kafka__opmon__consumer_8cxx.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a492352d997c1d6e6e6fac1c0ae4d5b96" id="r_a492352d997c1d6e6e6fac1c0ae4d5b96"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedunedaq.html#a492352d997c1d6e6e6fac1c0ae4d5b96">dunedaq::CannotCreateConsumer</a></td></tr>
<tr class="separator:a492352d997c1d6e6e6fac1c0ae4d5b96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a237cb72b34a1dcca7f443d29a8a907e6" id="r_a237cb72b34a1dcca7f443d29a8a907e6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">Cannot</a> create&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedunedaq.html#a237cb72b34a1dcca7f443d29a8a907e6">dunedaq::consumer</a></td></tr>
<tr class="separator:a237cb72b34a1dcca7f443d29a8a907e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ae51643d3c8c660c992705d1f4cf1d5" id="r_a2ae51643d3c8c660c992705d1f4cf1d5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">Cannot</a> create std::string fatal&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedunedaq.html#a2ae51643d3c8c660c992705d1f4cf1d5">dunedaq::IncorrectParameters</a></td></tr>
<tr class="separator:a2ae51643d3c8c660c992705d1f4cf1d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01ba1ac46319d6a9c4f8f6667ad2c86a" id="r_a01ba1ac46319d6a9c4f8f6667ad2c86a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">Cannot</a> create std::string fatal <a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">Incorrect</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedunedaq.html#a01ba1ac46319d6a9c4f8f6667ad2c86a">dunedaq::parameters</a></td></tr>
<tr class="separator:a01ba1ac46319d6a9c4f8f6667ad2c86a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebac00870c76427c40f194d448656e76" id="r_aebac00870c76427c40f194d448656e76"><td class="memItemLeft" align="right" valign="top">static volatile sig_atomic_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kafka__opmon__consumer_8cxx.html#aebac00870c76427c40f194d448656e76">run</a> = 1</td></tr>
<tr class="separator:aebac00870c76427c40f194d448656e76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3045fc39d9150d8d21526dad0bd6c8c9" id="r_a3045fc39d9150d8d21526dad0bd6c8c9"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">dunedaq::influxopmon::JsonConverter</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kafka__opmon__consumer_8cxx.html#a3045fc39d9150d8d21526dad0bd6c8c9">m_json_converter</a></td></tr>
<tr class="separator:a3045fc39d9150d8d21526dad0bd6c8c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4645c248afcf2710ddf5b87756d25dab" id="r_a4645c248afcf2710ddf5b87756d25dab"><td class="memItemLeft" align="right" valign="top">static std::vector&lt; std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kafka__opmon__consumer_8cxx.html#a4645c248afcf2710ddf5b87756d25dab">inserts_vectors</a></td></tr>
<tr class="separator:a4645c248afcf2710ddf5b87756d25dab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6934e608f0e5e51dddb1eb6c51581851" id="r_a6934e608f0e5e51dddb1eb6c51581851"><td class="memItemLeft" align="right" valign="top">static uint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kafka__opmon__consumer_8cxx.html#a6934e608f0e5e51dddb1eb6c51581851">seed</a> = 0</td></tr>
<tr class="separator:a6934e608f0e5e51dddb1eb6c51581851"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aca7dcd4a754790886cb4b5224de2442a" name="aca7dcd4a754790886cb4b5224de2442a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca7dcd4a754790886cb4b5224de2442a">&#9670;&#160;</a></span>consume_batch()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static std::vector&lt; std::unique_ptr&lt; RdKafka::Message &gt; &gt; consume_batch </td>
          <td>(</td>
          <td class="paramtype">RdKafka::KafkaConsumer &amp;&#160;</td>
          <td class="paramname"><em>consumer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>batch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>batch_tmout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="kafka__opmon__consumer_8cxx_source.html#l00052">52</a> of file <a class="el" href="kafka__opmon__consumer_8cxx_source.html">kafka_opmon_consumer.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   53</span>{</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>  std::vector&lt;std::unique_ptr&lt;RdKafka::Message&gt;&gt; msgs;</div>
<div class="line"><span class="lineno">   56</span>  msgs.reserve(batch_size);</div>
<div class="line"><span class="lineno">   57</span> </div>
<div class="line"><span class="lineno">   58</span>  int64_t end = <a class="code hl_function" href="kafka__opmon__consumer_8cxx.html#abea48909f8fcf1a40fe240b2efb25339">now</a>() + batch_tmout;</div>
<div class="line"><span class="lineno">   59</span>  <span class="keywordtype">int</span> remaining_timeout = batch_tmout;</div>
<div class="line"><span class="lineno">   60</span> </div>
<div class="line"><span class="lineno">   61</span>  <span class="keywordflow">while</span> (msgs.size() &lt; batch_size) {</div>
<div class="line"><span class="lineno">   62</span>    <span class="keyword">auto</span> msg = std::unique_ptr&lt;RdKafka::Message&gt;(<a class="code hl_variable" href="namespacedunedaq.html#a237cb72b34a1dcca7f443d29a8a907e6">consumer</a>.consume(remaining_timeout));</div>
<div class="line"><span class="lineno">   63</span> </div>
<div class="line"><span class="lineno">   64</span>    <span class="keywordflow">if</span> (msg == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">   65</span>      <a class="code hl_function" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>(dunedaq::kafkaopmon::CannotConsumeMessage(<a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, <span class="stringliteral">&quot;%% Consumer error: Message is null&quot;</span>));</div>
<div class="line"><span class="lineno">   66</span> </div>
<div class="line"><span class="lineno">   67</span>    <span class="keywordflow">switch</span> (msg-&gt;err()) {</div>
<div class="line"><span class="lineno">   68</span>      <span class="keywordflow">case</span> RdKafka::ERR__TIMED_OUT:</div>
<div class="line"><span class="lineno">   69</span>        <span class="keywordflow">return</span> msgs;</div>
<div class="line"><span class="lineno">   70</span> </div>
<div class="line"><span class="lineno">   71</span>      <span class="keywordflow">case</span> RdKafka::ERR_NO_ERROR:</div>
<div class="line"><span class="lineno">   72</span>        msgs.push_back(std::move(msg));</div>
<div class="line"><span class="lineno">   73</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   74</span> </div>
<div class="line"><span class="lineno">   75</span>      <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">   76</span>        <a class="code hl_function" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>(</div>
<div class="line"><span class="lineno">   77</span>          dunedaq::kafkaopmon::CannotConsumeMessage(<a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, <span class="stringliteral">&quot;%% Unhandled consumer error: &quot;</span> + msg-&gt;errstr()));</div>
<div class="line"><span class="lineno">   78</span>        <a class="code hl_variable" href="kafka__opmon__consumer_8cxx.html#aebac00870c76427c40f194d448656e76">run</a> = 0;</div>
<div class="line"><span class="lineno">   79</span>        <span class="keywordflow">return</span> msgs;</div>
<div class="line"><span class="lineno">   80</span>    }</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>    remaining_timeout = end - <a class="code hl_function" href="kafka__opmon__consumer_8cxx.html#abea48909f8fcf1a40fe240b2efb25339">now</a>();</div>
<div class="line"><span class="lineno">   83</span>    <span class="keywordflow">if</span> (remaining_timeout &lt; 0)</div>
<div class="line"><span class="lineno">   84</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   85</span>  }</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>  <span class="keywordflow">return</span> msgs;</div>
<div class="line"><span class="lineno">   88</span>}</div>
<div class="ttc" id="aLocalContext_8hpp_html_adea523c3dfceb9683f7acb5e719283ee"><div class="ttname"><a href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a></div><div class="ttdeci">#define ERS_HERE</div><div class="ttdef"><b>Definition</b> <a href="LocalContext_8hpp_source.html#l00130">LocalContext.hpp:130</a></div></div>
<div class="ttc" id="akafka__opmon__consumer_8cxx_html_abea48909f8fcf1a40fe240b2efb25339"><div class="ttname"><a href="kafka__opmon__consumer_8cxx.html#abea48909f8fcf1a40fe240b2efb25339">now</a></div><div class="ttdeci">static int64_t now()</div><div class="ttdef"><b>Definition</b> <a href="kafka__opmon__consumer_8cxx_source.html#l00044">kafka_opmon_consumer.cxx:44</a></div></div>
<div class="ttc" id="akafka__opmon__consumer_8cxx_html_aebac00870c76427c40f194d448656e76"><div class="ttname"><a href="kafka__opmon__consumer_8cxx.html#aebac00870c76427c40f194d448656e76">run</a></div><div class="ttdeci">static volatile sig_atomic_t run</div><div class="ttdef"><b>Definition</b> <a href="kafka__opmon__consumer_8cxx_source.html#l00038">kafka_opmon_consumer.cxx:38</a></div></div>
<div class="ttc" id="anamespacedunedaq_html_a237cb72b34a1dcca7f443d29a8a907e6"><div class="ttname"><a href="namespacedunedaq.html#a237cb72b34a1dcca7f443d29a8a907e6">dunedaq::consumer</a></div><div class="ttdeci">Cannot create consumer</div><div class="ttdef"><b>Definition</b> <a href="kafka__opmon__consumer_8cxx_source.html#l00029">kafka_opmon_consumer.cxx:29</a></div></div>
<div class="ttc" id="anamespaceers_html_aff4eee77205a91301c3c942ae1de25c6"><div class="ttname"><a href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a></div><div class="ttdeci">void error(const Issue &amp;issue)</div><div class="ttdef"><b>Definition</b> <a href="ers_8hpp_source.html#l00081">ers.hpp:81</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7b2edb9b85259bdc7e2a158fdcea8c7a" name="a7b2edb9b85259bdc7e2a158fdcea8c7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b2edb9b85259bdc7e2a158fdcea8c7a">&#9670;&#160;</a></span>consumerLoop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void consumerLoop </td>
          <td>(</td>
          <td class="paramtype">RdKafka::KafkaConsumer &amp;&#160;</td>
          <td class="paramname"><em>consumer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>batch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>batch_tmout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>adress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="kafka__opmon__consumer_8cxx_source.html#l00105">105</a> of file <a class="el" href="kafka__opmon__consumer_8cxx_source.html">kafka_opmon_consumer.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  106</span>{</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;Using query: &quot;</span> &lt;&lt; adress &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  109</span> </div>
<div class="line"><span class="lineno">  110</span>  <span class="keywordflow">while</span> (<a class="code hl_variable" href="kafka__opmon__consumer_8cxx.html#aebac00870c76427c40f194d448656e76">run</a>) {</div>
<div class="line"><span class="lineno">  111</span>    <span class="keyword">auto</span> msgs = <a class="code hl_function" href="kafka__opmon__consumer_8cxx.html#aca7dcd4a754790886cb4b5224de2442a">consume_batch</a>(consumer, batch_size, batch_tmout);</div>
<div class="line"><span class="lineno">  112</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; msg : msgs) {</div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>      <span class="comment">// execution_command(adress, message_text);</span></div>
<div class="line"><span class="lineno">  115</span>      std::string json_string(<span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(msg-&gt;payload()), msg-&gt;len());</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>      <span class="comment">// std::cout &lt;&lt; json_string &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  118</span>      <span class="comment">//  json message = json::parse( json_string );</span></div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>      <span class="comment">// std::string query;</span></div>
<div class="line"><span class="lineno">  121</span>      <span class="comment">// query = message[&quot;type&quot;].get&lt;std::string&gt;() + &#39;,&#39;;</span></div>
<div class="line"><span class="lineno">  122</span>      <span class="comment">// query += (&quot;source_id=&quot;+message[&quot;source_id&quot;].get&lt;std::string&gt;()+&#39;,&#39;);</span></div>
<div class="line"><span class="lineno">  123</span>      <span class="comment">// query += (&quot;partition_id=&quot;+message[&quot;partition_id&quot;].get&lt;std::string&gt;()+&#39; &#39;);</span></div>
<div class="line"><span class="lineno">  124</span>      <span class="comment">// const auto &amp; data = message[&quot;__data&quot;];</span></div>
<div class="line"><span class="lineno">  125</span>      <span class="comment">// std::stringstream data_stream;</span></div>
<div class="line"><span class="lineno">  126</span>      <span class="comment">// for ( auto it = data.begin() ; it != data.end() ; ++it ) {</span></div>
<div class="line"><span class="lineno">  127</span>      <span class="comment">//   if ( it != data.begin() ) data_stream &lt;&lt; &#39;,&#39; ;</span></div>
<div class="line"><span class="lineno">  128</span>      <span class="comment">//   data_stream &lt;&lt; it.key() &lt;&lt; &#39;=&#39; &lt;&lt; it.value() ;</span></div>
<div class="line"><span class="lineno">  129</span>      <span class="comment">// }</span></div>
<div class="line"><span class="lineno">  130</span>      <span class="comment">// query += data_stream.str();</span></div>
<div class="line"><span class="lineno">  131</span>      <span class="comment">// query += &#39; &#39;;</span></div>
<div class="line"><span class="lineno">  132</span>      <span class="comment">// query += std::to_string(message[&quot;__time&quot;].get&lt;uint64_t&gt;() * 1000000000);</span></div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>      <span class="comment">// execution_command(adress, query);</span></div>
<div class="line"><span class="lineno">  135</span>    }</div>
<div class="line"><span class="lineno">  136</span>  }</div>
<div class="line"><span class="lineno">  137</span>}</div>
<div class="ttc" id="akafka__opmon__consumer_8cxx_html_aca7dcd4a754790886cb4b5224de2442a"><div class="ttname"><a href="kafka__opmon__consumer_8cxx.html#aca7dcd4a754790886cb4b5224de2442a">consume_batch</a></div><div class="ttdeci">static std::vector&lt; std::unique_ptr&lt; RdKafka::Message &gt; &gt; consume_batch(RdKafka::KafkaConsumer &amp;consumer, size_t batch_size, int batch_tmout)</div><div class="ttdef"><b>Definition</b> <a href="kafka__opmon__consumer_8cxx_source.html#l00052">kafka_opmon_consumer.cxx:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a57ca4b1e14a743206e6b557916f899ee" name="a57ca4b1e14a743206e6b557916f899ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57ca4b1e14a743206e6b557916f899ee">&#9670;&#160;</a></span>execution_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void execution_command </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>adress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>cmd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="kafka__opmon__consumer_8cxx_source.html#l00091">91</a> of file <a class="el" href="kafka__opmon__consumer_8cxx_source.html">kafka_opmon_consumer.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   92</span>{</div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span>  cpr::Response <a class="code hl_variable" href="namespacesend-recv-restcmd.html#a1edf8c340dd8cb10435fb0d96a1a7455">response</a> = cpr::Post(cpr::Url{ adress }, cpr::Body{ <a class="code hl_function" href="namespacedunedaq.html#a32b26ec6a54e0c0849936cd5e14d9308">cmd</a> });</div>
<div class="line"><span class="lineno">   95</span>  <span class="comment">// std::cout &lt;&lt; cmd &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">   96</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacesend-recv-restcmd.html#a1edf8c340dd8cb10435fb0d96a1a7455">response</a>.status_code &gt;= 400) {</div>
<div class="line"><span class="lineno">   97</span>    <a class="code hl_function" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>(dunedaq::kafkaopmon::CannotPostToDb(</div>
<div class="line"><span class="lineno">   98</span>      <a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, <span class="stringliteral">&quot;Error [&quot;</span> + std::to_string(<a class="code hl_variable" href="namespacesend-recv-restcmd.html#a1edf8c340dd8cb10435fb0d96a1a7455">response</a>.status_code) + <span class="stringliteral">&quot;] making request&quot;</span>));</div>
<div class="line"><span class="lineno">   99</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacesend-recv-restcmd.html#a1edf8c340dd8cb10435fb0d96a1a7455">response</a>.status_code == 0) {</div>
<div class="line"><span class="lineno">  100</span>    <a class="code hl_function" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>(dunedaq::kafkaopmon::CannotPostToDb(<a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, <span class="stringliteral">&quot;Query returned 0&quot;</span>));</div>
<div class="line"><span class="lineno">  101</span>  }</div>
<div class="line"><span class="lineno">  102</span>}</div>
<div class="ttc" id="anamespacedunedaq_html_a32b26ec6a54e0c0849936cd5e14d9308"><div class="ttname"><a href="namespacedunedaq.html#a32b26ec6a54e0c0849936cd5e14d9308">dunedaq::cmd</a></div><div class="ttdeci">DAQModule std::string name Command registration std::string cmd((std::string) name)</div></div>
<div class="ttc" id="anamespacesend-recv-restcmd_html_a1edf8c340dd8cb10435fb0d96a1a7455"><div class="ttname"><a href="namespacesend-recv-restcmd.html#a1edf8c340dd8cb10435fb0d96a1a7455">send-recv-restcmd.response</a></div><div class="ttdeci">response</div><div class="ttdef"><b>Definition</b> <a href="send-recv-restcmd_8py_source.html#l00085">send-recv-restcmd.py:85</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0ddf1224851353fc92bfbff6f499fa97" name="a0ddf1224851353fc92bfbff6f499fa97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ddf1224851353fc92bfbff6f499fa97">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="kafka__opmon__consumer_8cxx_source.html#l00140">140</a> of file <a class="el" href="kafka__opmon__consumer_8cxx_source.html">kafka_opmon_consumer.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  141</span>{</div>
<div class="line"><span class="lineno">  142</span>  std::string broker;</div>
<div class="line"><span class="lineno">  143</span>  std::string topic;</div>
<div class="line"><span class="lineno">  144</span>  std::string db_host;</div>
<div class="line"><span class="lineno">  145</span>  std::string db_port;</div>
<div class="line"><span class="lineno">  146</span>  std::string db_path;</div>
<div class="line"><span class="lineno">  147</span>  std::string db_dbname;</div>
<div class="line"><span class="lineno">  148</span>  std::string topic_str;</div>
<div class="line"><span class="lineno">  149</span>  std::vector&lt;std::string&gt; topics;</div>
<div class="line"><span class="lineno">  150</span>  <span class="comment">// Bulk consume parameters</span></div>
<div class="line"><span class="lineno">  151</span>  <span class="keywordtype">int</span> batch_size = 100;</div>
<div class="line"><span class="lineno">  152</span>  <span class="keywordtype">int</span> batch_tmout = 1000;</div>
<div class="line"><span class="lineno">  153</span>  <span class="comment">// Kafka server settings</span></div>
<div class="line"><span class="lineno">  154</span>  std::string errstr;</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>  <span class="comment">// get parameters</span></div>
<div class="line"><span class="lineno">  157</span> </div>
<div class="line"><span class="lineno">  158</span>  bpo::options_description desc{ <span class="stringliteral">&quot;example: -broker 188.185.122.48:9092 -topic kafkaopmon-reporting -dbhost &quot;</span></div>
<div class="line"><span class="lineno">  159</span>                                 <span class="stringliteral">&quot;188.185.88.195 -dbport 80 -dbpath insert -dbname db1&quot;</span> };</div>
<div class="line"><span class="lineno">  160</span>  desc.add_options()(<span class="stringliteral">&quot;help,h&quot;</span>, <span class="stringliteral">&quot;Help screen&quot;</span>)(</div>
<div class="line"><span class="lineno">  161</span>    <span class="stringliteral">&quot;broker,b&quot;</span>, bpo::value&lt;std::string&gt;()-&gt;default_value(<span class="stringliteral">&quot;monkafka.cern.ch:30092&quot;</span>), <span class="stringliteral">&quot;Broker&quot;</span>)(</div>
<div class="line"><span class="lineno">  162</span>    <span class="stringliteral">&quot;topic,t&quot;</span>, bpo::value&lt;std::string&gt;()-&gt;default_value(<span class="stringliteral">&quot;opmon&quot;</span>), <span class="stringliteral">&quot;Topic&quot;</span>)(</div>
<div class="line"><span class="lineno">  163</span>    <span class="stringliteral">&quot;dbhost,ho&quot;</span>, bpo::value&lt;std::string&gt;()-&gt;default_value(<span class="stringliteral">&quot;opmondb.cern.ch&quot;</span>), <span class="stringliteral">&quot;Database host&quot;</span>)(</div>
<div class="line"><span class="lineno">  164</span>    <span class="stringliteral">&quot;dbport,po&quot;</span>, bpo::value&lt;std::string&gt;()-&gt;default_value(<span class="stringliteral">&quot;31002&quot;</span>), <span class="stringliteral">&quot;Database port&quot;</span>)(</div>
<div class="line"><span class="lineno">  165</span>    <span class="stringliteral">&quot;dbpath,pa&quot;</span>, bpo::value&lt;std::string&gt;()-&gt;default_value(<span class="stringliteral">&quot;write&quot;</span>), <span class="stringliteral">&quot;Database path&quot;</span>)(</div>
<div class="line"><span class="lineno">  166</span>    <span class="stringliteral">&quot;dbname,n&quot;</span>, bpo::value&lt;std::string&gt;()-&gt;default_value(<span class="stringliteral">&quot;influxdb&quot;</span>), <span class="stringliteral">&quot;Database name&quot;</span>);</div>
<div class="line"><span class="lineno">  167</span> </div>
<div class="line"><span class="lineno">  168</span>  bpo::variables_map vm;</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  171</span>    <span class="keyword">auto</span> parsed = bpo::command_line_parser(argc, argv).options(desc).run();</div>
<div class="line"><span class="lineno">  172</span>    bpo::store(parsed, vm);</div>
<div class="line"><span class="lineno">  173</span>  } <span class="keywordflow">catch</span> (bpo::error <span class="keyword">const</span>&amp; e) {</div>
<div class="line"><span class="lineno">  174</span>    <a class="code hl_function" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>(dunedaq::kafkaopmon::IncorrectParameters(<a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, e.what()));</div>
<div class="line"><span class="lineno">  175</span>  }</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>  <span class="keywordflow">if</span> (vm.count(<span class="stringliteral">&quot;help&quot;</span>)) {</div>
<div class="line"><span class="lineno">  178</span>    <a class="code hl_define" href="logging_2include_2logging_2internal_2macro_8hpp.html#a69dcfba03c6d43734c25d912a4f2288c">TLOG</a>() &lt;&lt; desc &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  179</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  180</span>  }</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>  broker = vm[<span class="stringliteral">&quot;broker&quot;</span>].as&lt;std::string&gt;();</div>
<div class="line"><span class="lineno">  183</span>  topic = vm[<span class="stringliteral">&quot;topic&quot;</span>].as&lt;std::string&gt;();</div>
<div class="line"><span class="lineno">  184</span>  db_host = vm[<span class="stringliteral">&quot;dbhost&quot;</span>].as&lt;std::string&gt;();</div>
<div class="line"><span class="lineno">  185</span>  db_port = vm[<span class="stringliteral">&quot;dbport&quot;</span>].as&lt;std::string&gt;();</div>
<div class="line"><span class="lineno">  186</span>  db_path = vm[<span class="stringliteral">&quot;dbpath&quot;</span>].as&lt;std::string&gt;();</div>
<div class="line"><span class="lineno">  187</span>  db_dbname = vm[<span class="stringliteral">&quot;dbname&quot;</span>].as&lt;std::string&gt;();</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>  <span class="comment">// Broker parameters</span></div>
<div class="line"><span class="lineno">  190</span> </div>
<div class="line"><span class="lineno">  191</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  192</span>    <span class="keyword">auto</span> conf = std::unique_ptr&lt;RdKafka::Conf&gt;(RdKafka::Conf::create(RdKafka::Conf::CONF_GLOBAL));</div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span>    srand((<span class="keywordtype">unsigned</span>)time(0));</div>
<div class="line"><span class="lineno">  195</span>    std::string group_id = <span class="stringliteral">&quot;opmon_microservices&quot;</span>;</div>
<div class="line"><span class="lineno">  196</span> </div>
<div class="line"><span class="lineno">  197</span>    conf-&gt;set(<span class="stringliteral">&quot;bootstrap.servers&quot;</span>, broker, errstr);</div>
<div class="line"><span class="lineno">  198</span>    <span class="keywordflow">if</span> (errstr != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><span class="lineno">  199</span>      <a class="code hl_function" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a>(dunedaq::kafkaopmon::CannotCreateConsumer(<a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, errstr));</div>
<div class="line"><span class="lineno">  200</span>    }</div>
<div class="line"><span class="lineno">  201</span>    conf-&gt;set(<span class="stringliteral">&quot;client.id&quot;</span>, <span class="stringliteral">&quot;opmon_microservice-0&quot;</span>, errstr);</div>
<div class="line"><span class="lineno">  202</span>    <span class="keywordflow">if</span> (errstr != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><span class="lineno">  203</span>      <a class="code hl_function" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a>(dunedaq::kafkaopmon::CannotCreateConsumer(<a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, errstr));</div>
<div class="line"><span class="lineno">  204</span>    }</div>
<div class="line"><span class="lineno">  205</span>    conf-&gt;set(<span class="stringliteral">&quot;group.id&quot;</span>, group_id, errstr);</div>
<div class="line"><span class="lineno">  206</span>    <span class="keywordflow">if</span> (errstr != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><span class="lineno">  207</span>      <a class="code hl_function" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a>(dunedaq::kafkaopmon::CannotCreateConsumer(<a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, errstr));</div>
<div class="line"><span class="lineno">  208</span>    }</div>
<div class="line"><span class="lineno">  209</span>    topics.push_back(topic);</div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span>    <span class="keyword">auto</span> <a class="code hl_variable" href="namespacedunedaq.html#a237cb72b34a1dcca7f443d29a8a907e6">consumer</a> = std::unique_ptr&lt;RdKafka::KafkaConsumer&gt;(RdKafka::KafkaConsumer::create(conf.get(), errstr));</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>    <span class="keywordflow">if</span> (errstr != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><span class="lineno">  214</span>      <a class="code hl_function" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a>(dunedaq::kafkaopmon::CannotCreateConsumer(<a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, errstr));</div>
<div class="line"><span class="lineno">  215</span>    }</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>    <span class="keywordflow">if</span> (consumer)</div>
<div class="line"><span class="lineno">  218</span>      <a class="code hl_variable" href="namespacedunedaq.html#a237cb72b34a1dcca7f443d29a8a907e6">consumer</a>-&gt;subscribe(topics);</div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  220</span>      <a class="code hl_function" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a>(dunedaq::kafkaopmon::CannotCreateConsumer(<a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, errstr));</div>
<div class="line"><span class="lineno">  221</span> </div>
<div class="line"><span class="lineno">  222</span>    <a class="code hl_function" href="kafka__opmon__consumer_8cxx.html#a7b2edb9b85259bdc7e2a158fdcea8c7a">consumerLoop</a>(*consumer, batch_size, batch_tmout, db_host + <span class="stringliteral">&quot;:&quot;</span> + db_port + <span class="stringliteral">&quot;/&quot;</span> + db_path + <span class="stringliteral">&quot;?db=&quot;</span> + db_dbname);</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>    <a class="code hl_variable" href="namespacedunedaq.html#a237cb72b34a1dcca7f443d29a8a907e6">consumer</a>-&gt;close();</div>
<div class="line"><span class="lineno">  225</span>  } <span class="keywordflow">catch</span> (ers::IssueCatcherAlreadySet&amp; ex) {</div>
<div class="line"><span class="lineno">  226</span>    <a class="code hl_function" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>(ex);</div>
<div class="line"><span class="lineno">  227</span>  }</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  230</span>}</div>
<div class="ttc" id="akafka__opmon__consumer_8cxx_html_a7b2edb9b85259bdc7e2a158fdcea8c7a"><div class="ttname"><a href="kafka__opmon__consumer_8cxx.html#a7b2edb9b85259bdc7e2a158fdcea8c7a">consumerLoop</a></div><div class="ttdeci">void consumerLoop(RdKafka::KafkaConsumer &amp;consumer, int batch_size, int batch_tmout, std::string adress)</div><div class="ttdef"><b>Definition</b> <a href="kafka__opmon__consumer_8cxx_source.html#l00105">kafka_opmon_consumer.cxx:105</a></div></div>
<div class="ttc" id="alogging_2include_2logging_2internal_2macro_8hpp_html_a69dcfba03c6d43734c25d912a4f2288c"><div class="ttname"><a href="logging_2include_2logging_2internal_2macro_8hpp.html#a69dcfba03c6d43734c25d912a4f2288c">TLOG</a></div><div class="ttdeci">#define TLOG(...)</div><div class="ttdef"><b>Definition</b> <a href="logging_2include_2logging_2internal_2macro_8hpp_source.html#l00022">macro.hpp:22</a></div></div>
<div class="ttc" id="anamespaceers_html_ae546de6c000e3e8eecda0c9fa9d78857"><div class="ttname"><a href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a></div><div class="ttdeci">void fatal(const Issue &amp;issue)</div><div class="ttdef"><b>Definition</b> <a href="ers_8hpp_source.html#l00088">ers.hpp:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abea48909f8fcf1a40fe240b2efb25339" name="abea48909f8fcf1a40fe240b2efb25339"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abea48909f8fcf1a40fe240b2efb25339">&#9670;&#160;</a></span>now()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int64_t now </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="kafka__opmon__consumer_8cxx_source.html#l00044">44</a> of file <a class="el" href="kafka__opmon__consumer_8cxx_source.html">kafka_opmon_consumer.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   45</span>{</div>
<div class="line"><span class="lineno">   46</span>  <span class="keyword">struct </span>timeval tv;</div>
<div class="line"><span class="lineno">   47</span>  gettimeofday(&amp;tv, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">   48</span>  <span class="keywordflow">return</span> ((int64_t)tv.tv_sec * 1000) + (tv.tv_usec / 1000);</div>
<div class="line"><span class="lineno">   49</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a4645c248afcf2710ddf5b87756d25dab" name="a4645c248afcf2710ddf5b87756d25dab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4645c248afcf2710ddf5b87756d25dab">&#9670;&#160;</a></span>inserts_vectors</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::string&gt; inserts_vectors</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="kafka__opmon__consumer_8cxx_source.html#l00040">40</a> of file <a class="el" href="kafka__opmon__consumer_8cxx_source.html">kafka_opmon_consumer.cxx</a>.</p>

</div>
</div>
<a id="a3045fc39d9150d8d21526dad0bd6c8c9" name="a3045fc39d9150d8d21526dad0bd6c8c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3045fc39d9150d8d21526dad0bd6c8c9">&#9670;&#160;</a></span>m_json_converter</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacedunedaq.html#ab00b75d7698751046d10e0f20b0e970e">dunedaq::influxopmon::JsonConverter</a> m_json_converter</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="kafka__opmon__consumer_8cxx_source.html#l00039">39</a> of file <a class="el" href="kafka__opmon__consumer_8cxx_source.html">kafka_opmon_consumer.cxx</a>.</p>

</div>
</div>
<a id="aebac00870c76427c40f194d448656e76" name="aebac00870c76427c40f194d448656e76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebac00870c76427c40f194d448656e76">&#9670;&#160;</a></span>run</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">volatile sig_atomic_t run = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="kafka__opmon__consumer_8cxx_source.html#l00038">38</a> of file <a class="el" href="kafka__opmon__consumer_8cxx_source.html">kafka_opmon_consumer.cxx</a>.</p>

</div>
</div>
<a id="a6934e608f0e5e51dddb1eb6c51581851" name="a6934e608f0e5e51dddb1eb6c51581851"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6934e608f0e5e51dddb1eb6c51581851">&#9670;&#160;</a></span>seed</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint seed = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="kafka__opmon__consumer_8cxx_source.html#l00041">41</a> of file <a class="el" href="kafka__opmon__consumer_8cxx_source.html">kafka_opmon_consumer.cxx</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 24 2024 for DUNE-DAQ by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
