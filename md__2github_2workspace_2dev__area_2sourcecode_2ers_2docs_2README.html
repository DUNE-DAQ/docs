<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: Error Reporting Service (ERS)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Error Reporting Service (ERS)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md364"></a> The Error Reporting System (ERS) software package provides a common API for error reporting in the ATLAS TDAQ system. ERS offers several macro that can be used for reporting pre-defined errors if some conditions are violated at the level of C++ code. ERS also provides tools for defining custom classes that can be used for reporting high-level issues.</p>
<p>The Error Reporting System (ERS) software package provides a common API for error reporting in the ATLAS TDAQ system. ERS offers several macro that can be used for reporting pre-defined errors if some conditions are violated at the level of C++ code. ERS also provides tools for defining custom classes that can be used for reporting high-level issues.</p>
<h1><a class="anchor" id="autotoc_md365"></a>
Header File</h1>
<p>In order to use ERS functionality an application has to include a single header file <b><a class="el" href="ers_8hpp.html">ers/ers.hpp</a></b></p>
<h1><a class="anchor" id="autotoc_md366"></a>
Assertion Macro</h1>
<p>ERS provides several convenience macro for checking conditions in a C++ code. If a certain condition is violated a corresponding macro creates a new instance of <b>ers::Assertion</b> class and sends it to the <b><a class="el" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a></b> stream. Further processing depends on the <b><a class="el" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a></b> stream configuration. By default the issue is printed to the standard error stream.</p>
<p>Here is a list of available macro:</p><ul>
<li><b><a class="el" href="Assertion_8hpp.html#ae0c492758fd2eb202e4a110368cb7443">ERS_ASSERT( expression )</a></b> generic macro that checks whether a given expression is valid.</li>
<li><b><a class="el" href="Assertion_8hpp.html#a98794734f8eff7fffec1c1a80823fb5a">ERS_PRECONDITION( expression )</a></b> the same as ERS_ASSERT but uses a message that is adopted for reporting an invalid input parameter for a function.</li>
<li><b><a class="el" href="Assertion_8hpp.html#a7dd40762c9ef3d84fec7d80f7d6fe5e4">ERS_RANGE_CHECK( min, val, max )</a></b> is a special type of pre-condition, which checks that a value is in a range between min and max values.</li>
<li><b><a class="el" href="Assertion_8hpp.html#abc66a12f0a9ddb6a9f0e70a3cb122942">ERS_STRICT_RANGE_CHECK( min, val, max )</a></b> is similar to the ERS_RANGE_CHECK but does not allow the checked value to be equal to either min or max values.</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>Note:</b> These macro are defined to empty statements if <b>ERS_NO_DEBUG</b> macro is defined at compilation time. </p>
</blockquote>
<p>The amount of information, which is printed for an issue depends on the actual ERS verbosity level, which can be controlled via the <b>DUNEDAQ_ERS_VERBOSITY_LEVEL</b> macro. Default verbosity level is zero. In this case the following information is reported for any issue:</p><ul>
<li>severity (DEBUG, LOG, INFO, WARNING, ERROR, FATAL)</li>
<li>the time of the issue occurrence</li>
<li>the issue's context, which includes package name, file name, function name and line number</li>
<li>the issue's message</li>
</ul>
<p>One can control the current verbosity level via the <b>DUNEDAQ_ERS_VERBOSITY_LEVEL</b> macro:</p>
<div class="fragment"><div class="line">export DUNEDAQ_ERS_VERBOSITY_LEVEL=N</div>
</div><!-- fragment --><p>where N must be an integer number.</p>
<ul>
<li>For N &gt; 0 the issue attributes names and values are reported in addition to 0-level data</li>
<li>For N &gt; 1 the following information is added to the issue:<ul>
<li>host name</li>
<li>user name</li>
<li>process id</li>
<li>process current working directory</li>
</ul>
</li>
<li>For N &gt; 2 a stack trace is added to each issue if the code was compiled without <b>ERS_NO_DEBUG</b> macro.</li>
</ul>
<h1><a class="anchor" id="autotoc_md367"></a>
Using Custom Issue Classes</h1>
<p>ERS assumes that user functions should throw exceptions in case of errors. If such exceptions are instances of classes, which inherit the <b><a class="el" href="classers_1_1Issue.html" title="Base class for any user define issue.">ers::Issue</a></b> one, ERS offers a number of advantages with respect to their handling:</p><ul>
<li>ERS issues can be reported to any ERS stream</li>
<li>One can create chains of issues to preserve the original cause of the problem as well as the error handling sequence</li>
<li>ERS issues can be printed to a standard C++ output stream using the output operator provided by ERS</li>
</ul>
<p>In order to define a custom issue one has to do the following steps:</p><ul>
<li>Declare a class, which inherits <b><a class="el" href="classers_1_1Issue.html" title="Base class for any user define issue.">ers::Issue</a></b></li>
<li>Implement 3 pure virtual functions, declared in the ers:Issue class</li>
<li>Register new class using the <b><a class="el" href="classers_1_1IssueFactory.html#a78494d859a3e5c1c275cb2136e8c0c13" title="register an issue factory">ers::IssueFactory::register_issue</a></b> function</li>
</ul>
<p>ERS defines two helper macro, which implement all these steps. The macro are called ERS_DECLARE_ISSUE and ERS_DECLARE_ISSUE_BASE. The first one should be used to declare an issue class that inherits from the <b><a class="el" href="classers_1_1Issue.html" title="Base class for any user define issue.">ers::Issue</a></b> as it is shown on the following example:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="logging_2include_2logging_2internal_2macro_8hpp.html#a1430d021d3f90d61dab3ca0b75d4df25">ERS_DECLARE_ISSUE</a>(</div>
<div class="line"><a class="code hl_namespace" href="namespaceers.html">ers</a>,                                                              <span class="comment">// namespace</span></div>
<div class="line">    Assertion,                                                    <span class="comment">// issue name</span></div>
<div class="line">    <span class="stringliteral">&quot;Assertion (&quot;</span> &lt;&lt; condition &lt;&lt; <span class="stringliteral">&quot;) failed because &quot;</span> &lt;&lt; reason,  <span class="comment">// message</span></div>
<div class="line">    ((<span class="keyword">const</span> <span class="keywordtype">char</span> *)condition )                                    <span class="comment">// first attribute</span></div>
<div class="line">    ((<span class="keyword">const</span> <span class="keywordtype">char</span> *)reason )                                       <span class="comment">// second attribute</span></div>
<div class="line">)</div>
<div class="ttc" id="alogging_2include_2logging_2internal_2macro_8hpp_html_a1430d021d3f90d61dab3ca0b75d4df25"><div class="ttname"><a href="logging_2include_2logging_2internal_2macro_8hpp.html#a1430d021d3f90d61dab3ca0b75d4df25">ERS_DECLARE_ISSUE</a></div><div class="ttdeci">#define ERS_DECLARE_ISSUE( namespace_name, class_name, message_, attributes)</div><div class="ttdef"><b>Definition</b> <a href="logging_2include_2logging_2internal_2macro_8hpp_source.html#l00065">macro.hpp:65</a></div></div>
<div class="ttc" id="anamespaceers_html"><div class="ttname"><a href="namespaceers.html">ers</a></div><div class="ttdef"><b>Definition</b> <a href="Logger_8hxx_source.html#l00201">Logger.hxx:202</a></div></div>
</div><!-- fragment --><p>Note that attribute names may appear in the message expression. Also note a special syntax of the attributes declaration, which must always be declared using a list of **((attribute_type)attribute_name)** tokens. All the brackets in this expression are essential. Do not use commas to separate attributes. The only requirement for the type of an issue attribute is that for this type must be defined the output operator to the standard C++ output stream and the input operator from the standard C++ input stream. It is important to note that these operators must unambiguously match each other, i.e. the input operator must be able to unambiguously restore the state of the attribute from a stream, which had been used to save the object's state with the output operator. Evidently all the built-in C++ types satisfy this criteria. The result of the <b>ERS_DECLARE_ISSUE</b> macro expansion would look like:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceers.html">ers</a> {</div>
<div class="line">    <span class="keyword">class </span>Assertion : <span class="keyword">public</span> <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> {</div>
<div class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="keyword">friend</span> <span class="keyword">class </span><a class="code hl_class" href="classers_1_1IssueRegistrator.html">ers::IssueRegistrator</a>;</div>
<div class="line">        Assertion() { ; }</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * get_uid() { <span class="keywordflow">return</span> <span class="stringliteral">&quot;ers::Assertion&quot;</span>; }</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">virtual</span> <span class="keywordtype">void</span> raise() <span class="keyword">const</span> throw( <a class="code hl_namespace" href="namespacestd.html">std</a>::<a class="code hl_variable" href="config__dump_8cxx.html#a3a69c51778583cf2ea94834553307fee">exception</a> ) { <span class="keywordflow">throw</span> *<span class="keyword">this</span>; }</div>
<div class="line">        <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * get_class_name()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> get_uid(); }</div>
<div class="line">        <span class="keyword">virtual</span> <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> * clone()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">new</span> ers::Assertion( *<span class="keyword">this</span> ); }</div>
<div class="line">        </div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        Assertion( <span class="keyword">const</span> <a class="code hl_class" href="classers_1_1Context.html">ers::Context</a> &amp; context , <span class="keyword">const</span> <span class="keywordtype">char</span> * condition , <span class="keyword">const</span> <span class="keywordtype">char</span> * reason )</div>
<div class="line">            : <a class="code hl_namespace" href="namespaceers.html">ers</a>::Issue( context ) {</div>
<div class="line">            <a class="code hl_function" href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">set_value</a>( <span class="stringliteral">&quot;condition&quot;</span>, condition );</div>
<div class="line">            <a class="code hl_function" href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">set_value</a>( <span class="stringliteral">&quot;reason&quot;</span>, reason );</div>
<div class="line">            std::ostringstream <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a>;</div>
<div class="line">            <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a> &lt;&lt; <span class="stringliteral">&quot;Assertion (&quot;</span> &lt;&lt; condition &lt;&lt; <span class="stringliteral">&quot;) failed because &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacedbe_1_1config_1_1errors.html#acea7d59bcaefe2993116b5cdbe51c257">reason</a>;</div>
<div class="line">            set_message( <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a>.str() );</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        Assertion( <span class="keyword">const</span> <a class="code hl_class" href="classers_1_1Context.html">ers::Context</a> &amp; context, <span class="keyword">const</span> std::string &amp; msg , <span class="keyword">const</span> <span class="keywordtype">char</span> * condition , <span class="keyword">const</span> <span class="keywordtype">char</span> * reason )</div>
<div class="line">            : <a class="code hl_namespace" href="namespaceers.html">ers</a>::Issue( context, msg ) {</div>
<div class="line">            <a class="code hl_function" href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">set_value</a>( <span class="stringliteral">&quot;condition&quot;</span>, condition );</div>
<div class="line">            <a class="code hl_function" href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">set_value</a>( <span class="stringliteral">&quot;reason&quot;</span>, reason );</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        Assertion( <span class="keyword">const</span> <a class="code hl_class" href="classers_1_1Context.html">ers::Context</a> &amp; context , <span class="keyword">const</span> <span class="keywordtype">char</span> * condition , <span class="keyword">const</span> <span class="keywordtype">char</span> * reason , <span class="keyword">const</span> std::exception &amp; cause )</div>
<div class="line">            : <a class="code hl_namespace" href="namespaceers.html">ers</a>::Issue( context, cause ) {</div>
<div class="line">            <a class="code hl_function" href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">set_value</a>( <span class="stringliteral">&quot;condition&quot;</span>, condition );</div>
<div class="line">            <a class="code hl_function" href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">set_value</a>( <span class="stringliteral">&quot;reason&quot;</span>, reason );</div>
<div class="line">            std::ostringstream <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a>;</div>
<div class="line">            <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a> &lt;&lt; <span class="stringliteral">&quot;Assertion (&quot;</span> &lt;&lt; condition &lt;&lt; <span class="stringliteral">&quot;) failed because &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacedbe_1_1config_1_1errors.html#acea7d59bcaefe2993116b5cdbe51c257">reason</a>;</div>
<div class="line">            set_message( <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a>.str() );</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> * get_condition () {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span> * val;</div>
<div class="line">            get_value( <span class="stringliteral">&quot;condition&quot;</span>, val );</div>
<div class="line">            <span class="keywordflow">return</span> val;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> * get_reason () {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span> * val;</div>
<div class="line">            get_value( <span class="stringliteral">&quot;reason&quot;</span>, val );</div>
<div class="line">            <span class="keywordflow">return</span> val;</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line">}</div>
<div class="ttc" id="aclassers_1_1Context_html"><div class="ttname"><a href="classers_1_1Context.html">ers::Context</a></div><div class="ttdoc">An abstract interface to access an Issue context.</div><div class="ttdef"><b>Definition</b> <a href="Context_8hpp_source.html#l00029">Context.hpp:30</a></div></div>
<div class="ttc" id="aclassers_1_1IssueRegistrator_html"><div class="ttname"><a href="classers_1_1IssueRegistrator.html">ers::IssueRegistrator</a></div><div class="ttdef"><b>Definition</b> <a href="Issue_8hpp_source.html#l00047">Issue.hpp:47</a></div></div>
<div class="ttc" id="aclassers_1_1Issue_html"><div class="ttname"><a href="classers_1_1Issue.html">ers::Issue</a></div><div class="ttdoc">Base class for any user define issue.</div><div class="ttdef"><b>Definition</b> <a href="Issue_8hpp_source.html#l00068">Issue.hpp:69</a></div></div>
<div class="ttc" id="aconfig__dump_8cxx_html_a3a69c51778583cf2ea94834553307fee"><div class="ttname"><a href="config__dump_8cxx.html#a3a69c51778583cf2ea94834553307fee">exception</a></div><div class="ttdeci">caught dunedaq::conffwk::Exception exception</div><div class="ttdef"><b>Definition</b> <a href="config__dump_8cxx_source.html#l00024">config_dump.cxx:24</a></div></div>
<div class="ttc" id="anamespacedbe_1_1config_1_1errors_html_acea7d59bcaefe2993116b5cdbe51c257"><div class="ttname"><a href="namespacedbe_1_1config_1_1errors.html#acea7d59bcaefe2993116b5cdbe51c257">dbe::config::errors::reason</a></div><div class="ttdeci">std::string const reason(ers::Issue const &amp;)</div><div class="ttdef"><b>Definition</b> <a href="config__api_8cpp_source.html#l00073">config_api.cpp:73</a></div></div>
<div class="ttc" id="anamespacedunedaq_1_1opmonlib_html_a2adccb0379de8cb425943c20c0d32929"><div class="ttname"><a href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">dunedaq::opmonlib::set_value</a></div><div class="ttdeci">void set_value(google::protobuf::Message &amp;m, const std::string &amp;name, T value)</div><div class="ttdef"><b>Definition</b> <a href="Utils_8hxx_source.html#l00017">Utils.hxx:17</a></div></div>
<div class="ttc" id="anamespacedunedaq_html_a291b829cf1388628b50f25c8a625adcf"><div class="ttname"><a href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">dunedaq::out</a></div><div class="ttdeci">FELIX Initialization std::string initerror FELIX queue timed out</div><div class="ttdef"><b>Definition</b> <a href="FelixIssues_8hpp_source.html#l00023">FelixIssues.hpp:23</a></div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition</b> <a href="SchemaUtils_8hpp_source.html#l00140">SchemaUtils.hpp:140</a></div></div>
</div><!-- fragment --><p>The macro <b>ERS_DECLARE_ISSUE_BASE</b> has to be used if one wants to declare a new issue class, which inherits from one of the other custom ERS issue classes. For example, the following class inherits from the <b>ers::Assertion</b> class defined above:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="logging_2include_2logging_2internal_2macro_8hpp.html#a331bab0a539ee877037986e83a50e0ac">ERS_DECLARE_ISSUE_BASE</a>(<a class="code hl_namespace" href="namespaceers.html">ers</a>,                                          <span class="comment">// namespace name</span></div>
<div class="line">      Precondition,                                                  <span class="comment">// issue name</span></div>
<div class="line">      ers::Assertion,                                                <span class="comment">// base issue name</span></div>
<div class="line">      <span class="stringliteral">&quot;Precondition (&quot;</span> &lt;&lt; condition &lt;&lt; <span class="stringliteral">&quot;) located in &quot;</span> &lt;&lt; location</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot; failed because &quot;</span> &lt;&lt; reason,                                 <span class="comment">// message</span></div>
<div class="line">      ((<span class="keyword">const</span> <span class="keywordtype">char</span> *)condition ) ((<span class="keyword">const</span> <span class="keywordtype">char</span> *)reason ),            <span class="comment">// base class attributes</span></div>
<div class="line">       ((<span class="keyword">const</span> <span class="keywordtype">char</span> *)location )                                     <span class="comment">// this class attributes</span></div>
<div class="line">)</div>
<div class="ttc" id="alogging_2include_2logging_2internal_2macro_8hpp_html_a331bab0a539ee877037986e83a50e0ac"><div class="ttname"><a href="logging_2include_2logging_2internal_2macro_8hpp.html#a331bab0a539ee877037986e83a50e0ac">ERS_DECLARE_ISSUE_BASE</a></div><div class="ttdeci">#define ERS_DECLARE_ISSUE_BASE( namespace_name, class_name, base_class_name, message_, base_attributes, attributes)</div><div class="ttdef"><b>Definition</b> <a href="logging_2include_2logging_2internal_2macro_8hpp_source.html#l00045">macro.hpp:45</a></div></div>
</div><!-- fragment --><p>The result of the <b>ERS_DECLARE_ISSUE_BASE</b> macro expansion looks like:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceers.html">ers</a> {</div>
<div class="line">    <span class="keyword">class </span>Precondition : <span class="keyword">public</span> ers::Assertion {</div>
<div class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="keyword">friend</span> <span class="keyword">class </span><a class="code hl_class" href="classers_1_1IssueRegistrator.html">ers::IssueRegistrator</a>;</div>
<div class="line">        Precondition() { ; }</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> registered = <a class="code hl_class" href="classers_1_1IssueRegistrator.html">ers::IssueRegistrator&lt; ers::Precondition &gt;::instance</a>.done;</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * get_uid() { <span class="keywordflow">return</span> <span class="stringliteral">&quot;ers::Precondition&quot;</span>; }</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">virtual</span> <span class="keywordtype">void</span> raise() <span class="keyword">const</span> throw( <a class="code hl_namespace" href="namespacestd.html">std</a>::<a class="code hl_variable" href="config__dump_8cxx.html#a3a69c51778583cf2ea94834553307fee">exception</a> ) { <span class="keywordflow">throw</span> *<span class="keyword">this</span>; }</div>
<div class="line">        <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * get_class_name()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> get_uid(); }</div>
<div class="line">        <span class="keyword">virtual</span> <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> * clone()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">new</span> ers::Precondition( *<span class="keyword">this</span> ); }</div>
<div class="line">        </div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        Precondition( <span class="keyword">const</span> <a class="code hl_class" href="classers_1_1Context.html">ers::Context</a> &amp; context , <span class="keyword">const</span> <span class="keywordtype">char</span> * condition , <span class="keyword">const</span> <span class="keywordtype">char</span> * reason, <span class="keyword">const</span> <span class="keywordtype">char</span> * location )</div>
<div class="line">            : <a class="code hl_namespace" href="namespaceers.html">ers</a>::Assertion( context, condition, <a class="code hl_function" href="namespacedbe_1_1config_1_1errors.html#acea7d59bcaefe2993116b5cdbe51c257">reason</a> ) {</div>
<div class="line">                <a class="code hl_function" href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">set_value</a>( <span class="stringliteral">&quot;location&quot;</span>, location );</div>
<div class="line">            std::ostringstream <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a>;</div>
<div class="line">            <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a> &lt;&lt; <span class="stringliteral">&quot;Precondition (&quot;</span> &lt;&lt; condition &lt;&lt; <span class="stringliteral">&quot;) located in &quot;</span> &lt;&lt; location &lt;&lt; <span class="stringliteral">&quot;) failed because &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacedbe_1_1config_1_1errors.html#acea7d59bcaefe2993116b5cdbe51c257">reason</a>;</div>
<div class="line">            set_message( <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a>.str() );</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        Precondition( <span class="keyword">const</span> <a class="code hl_class" href="classers_1_1Context.html">ers::Context</a> &amp; context, <span class="keyword">const</span> std::string &amp; msg , <span class="keyword">const</span> <span class="keywordtype">char</span> * condition , <span class="keyword">const</span> <span class="keywordtype">char</span> * reason, <span class="keyword">const</span> <span class="keywordtype">char</span> * location )</div>
<div class="line">            : <a class="code hl_namespace" href="namespaceers.html">ers</a>::Assertion( context, msg, condition, <a class="code hl_function" href="namespacedbe_1_1config_1_1errors.html#acea7d59bcaefe2993116b5cdbe51c257">reason</a> ) {</div>
<div class="line">            <a class="code hl_function" href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">set_value</a>( <span class="stringliteral">&quot;location&quot;</span>, location );</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        Precondition( <span class="keyword">const</span> <a class="code hl_class" href="classers_1_1Context.html">ers::Context</a> &amp; context , <span class="keyword">const</span> <span class="keywordtype">char</span> * condition , <span class="keyword">const</span> <span class="keywordtype">char</span> * reason , <span class="keyword">const</span> <span class="keywordtype">char</span> * location, <span class="keyword">const</span> std::exception &amp; cause )</div>
<div class="line">            : <a class="code hl_namespace" href="namespaceers.html">ers</a>::Assertion( context, condition, <a class="code hl_function" href="namespacedbe_1_1config_1_1errors.html#acea7d59bcaefe2993116b5cdbe51c257">reason</a>, cause ) {</div>
<div class="line">            <a class="code hl_function" href="namespacedunedaq_1_1opmonlib.html#a2adccb0379de8cb425943c20c0d32929">set_value</a>( <span class="stringliteral">&quot;location&quot;</span>, location );</div>
<div class="line">            std::ostringstream <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a>;</div>
<div class="line">            <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a> &lt;&lt; <span class="stringliteral">&quot;Precondition (&quot;</span> &lt;&lt; condition &lt;&lt; <span class="stringliteral">&quot;) located in &quot;</span> &lt;&lt; location &lt;&lt; <span class="stringliteral">&quot;) failed because &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacedbe_1_1config_1_1errors.html#acea7d59bcaefe2993116b5cdbe51c257">reason</a>;</div>
<div class="line">            set_message( <a class="code hl_variable" href="namespacedunedaq.html#a291b829cf1388628b50f25c8a625adcf">out</a>.str() );</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> * get_location () {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span> * val;</div>
<div class="line">            get_value( <span class="stringliteral">&quot;location&quot;</span>, val );</div>
<div class="line">            <span class="keywordflow">return</span> val;</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md368"></a>
ERS_HERE macro</h1>
<p>The macro ERS_HERE is a convenience macro that is used to add the context information, like the file name, the line number and the signature of the function where the issue was constructed, to the new issue object. This means that when a new issue is created one shall always use ERS_HERE macro as the first parameter of the issue constructor.</p>
<h1><a class="anchor" id="autotoc_md369"></a>
Exception Handling</h1>
<p>Functions, which can throw exceptions must be invoked inside <b>try...catch</b> statement. The following example shows a typical use case of handling ERS exceptions.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="SampleIssues_8hpp.html">ers/SampleIssues.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        foo( );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( ers::PermissionDenied &amp; ex ) {</div>
<div class="line">        ers::CantOpenFile issue( <a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, ex.get_file_name(), ex );</div>
<div class="line">        <a class="code hl_function" href="namespaceers.html#a1f13d0d03ff2e1c3f3b2a9c388a20648">ers::warning</a>( issue );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( ers::FileDoesNotExist &amp; ex ) {</div>
<div class="line">        ers::CantOpenFile issue( <a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, ex.get_file_name(), ex );</div>
<div class="line">        <a class="code hl_function" href="namespaceers.html#a1f13d0d03ff2e1c3f3b2a9c388a20648">ers::warning</a>( issue );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> &amp; ex ) {</div>
<div class="line">        ERS_DEBUG( 0, <span class="stringliteral">&quot;Unknown issue caught: &quot;</span> &lt;&lt; ex )</div>
<div class="line">        <a class="code hl_function" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>( ex );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( std::exception &amp; ex ) {</div>
<div class="line">        ers::CantOpenFile issue( <a class="code hl_define" href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a>, <span class="stringliteral">&quot;unknown&quot;</span>, ex );</div>
<div class="line">        <a class="code hl_function" href="namespaceers.html#a1f13d0d03ff2e1c3f3b2a9c388a20648">ers::warning</a>( issue );</div>
<div class="line">    }</div>
<div class="ttc" id="aLocalContext_8hpp_html_adea523c3dfceb9683f7acb5e719283ee"><div class="ttname"><a href="LocalContext_8hpp.html#adea523c3dfceb9683f7acb5e719283ee">ERS_HERE</a></div><div class="ttdeci">#define ERS_HERE</div><div class="ttdef"><b>Definition</b> <a href="LocalContext_8hpp_source.html#l00130">LocalContext.hpp:130</a></div></div>
<div class="ttc" id="aSampleIssues_8hpp_html"><div class="ttname"><a href="SampleIssues_8hpp.html">SampleIssues.hpp</a></div></div>
<div class="ttc" id="anamespaceers_html_a1f13d0d03ff2e1c3f3b2a9c388a20648"><div class="ttname"><a href="namespaceers.html#a1f13d0d03ff2e1c3f3b2a9c388a20648">ers::warning</a></div><div class="ttdeci">void warning(const Issue &amp;issue)</div><div class="ttdef"><b>Definition</b> <a href="ers_8hpp_source.html#l00115">ers.hpp:115</a></div></div>
<div class="ttc" id="anamespaceers_html_aff4eee77205a91301c3c942ae1de25c6"><div class="ttname"><a href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a></div><div class="ttdeci">void error(const Issue &amp;issue)</div><div class="ttdef"><b>Definition</b> <a href="ers_8hpp_source.html#l00081">ers.hpp:81</a></div></div>
</div><!-- fragment --><p>This example demonstrates the main features of the ERS API:</p><ul>
<li>An issue does not have severity by itself. Severity of the issue is defined by the stream to which this issue is reported.</li>
<li>An issue can be send to one of the existing ERS streams using one of the following functions: <a class="el" href="namespaceers.html#ac65ce1c997e5ab6d96ca822baf109f69">ers::debug</a>, <a class="el" href="namespaceers.html#a2123c7b55b0ce7e62bd36965ad324697">ers::info</a>, <a class="el" href="namespaceers.html#a1f13d0d03ff2e1c3f3b2a9c388a20648">ers::warning</a>, <a class="el" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>, <a class="el" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a></li>
<li>Any ERS issue has a constructor, which accepts another issue as its last parameter. If this constructor is used the new issue will hold the copy of the original one and will report it as its cause.</li>
<li>Any ERS issue has a constructor, which accepts std::exception issue as its last parameter. If it is used the new issue will hold the copy of the given std::exception one and will report it as its cause.</li>
</ul>
<h1><a class="anchor" id="autotoc_md370"></a>
Configuring ERS Streams</h1>
<p>The ERS system provides multiple instances of the stream API, one per severity level, to report issues. The issues which are sent to different streams may be forwarded to different destinations depending on a particular stream configuration. By default the ERS streams are configured in the following way:</p><ul>
<li><a class="el" href="namespaceers.html#ac65ce1c997e5ab6d96ca822baf109f69">ers::debug</a> - "lstdout" - prints issues to the standard C++ output stream</li>
<li><a class="el" href="namespaceers.html#a23a61637f5fab8c8442ef7dc4f7d29a9">ers::log</a> - "lstdout" - prints issues to the standard C++ output stream</li>
<li><a class="el" href="namespaceers.html#a2123c7b55b0ce7e62bd36965ad324697">ers::info</a> - "throttle,lstdout" - prints throttled issues to the standard C++ output stream</li>
<li><a class="el" href="namespaceers.html#a1f13d0d03ff2e1c3f3b2a9c388a20648">ers::warning</a> - "throttle,lstderr" - prints throttled issues to the standard C++ error stream</li>
<li><a class="el" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a> - "throttle,lstderr" - prints throttled issues to the standard C++ error stream</li>
<li><a class="el" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a> - "lstderr" - prints issues to the standard C++ error stream</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>Note:</b> the letter "l" at the beginning of "lstdout" and "lstderr" names indicates that these stream implementations are thread-safe and can be safely used in multi-threaded applications so that issues reported from different threads will not be mixed up in the output. </p>
</blockquote>
<p>In order to change the default configuration for an ERS stream one should use the <b>DUNEDAQ_ERS_&lt;SEVERITY&gt;</b> environment variable. For example the following command:</p>
<div class="fragment"><div class="line">export DUNEDAQ_ERS_ERROR=&quot;lstderr,throw&quot; </div>
</div><!-- fragment --><p>will cause all the issues, which are sent to the <a class="el" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a> stream, been printed to the standard C++ error stream and then been thrown using the C++ throw operator.</p>
<p>A filter stream can also be associated with any severity level. For example:</p>
<div class="fragment"><div class="line">export DUNEDAQ_ERS_ERROR=&quot;lstderr,filter(ipc),throw&quot; </div>
</div><!-- fragment --><p>The difference with the previous configuration is that only errors, which have "ipc" qualifier will be passed to the "throw" stream. Users can add any qualifiers to their specific issues by using the <b>Issue::add_qualifier</b> function. By default every issue has one qualifier associated with it - the name of the TDAQ software package, which builds the binary (a library or an application) where the issue object is constructed.</p>
<p>One can also define complex and reversed filters like in the following example:</p>
<div class="fragment"><div class="line">&gt; export DUNEDAQ_ERS_ERROR=&quot;lstderr,filter(!ipc,!is),throw&quot;</div>
</div><!-- fragment --><p>This configuration will throw all the errors, which come neither from "ipc" nor from "is" TDAQ packages.</p>
<h2><a class="anchor" id="autotoc_md371"></a>
Existing Stream Implementations</h2>
<p>ERS provides several stream implementations which can be used in any combination in ERS streams configurations. Here is the list of available stream implementations:</p><ul>
<li>"stdout" - prints issues to the standard C++ output stream. It is not thread-safe.</li>
<li>"stderr" - prints issues to the standard C++ error stream. It is not thread-safe.</li>
<li>"lstdout" - prints issues to the standard C++ output stream. It is thread-safe.</li>
<li>"lstderr" - prints issues to the standard C++ error stream. It is thread-safe.</li>
<li>"lock" - locks a global mutex for the duration of reporting an issue to the next streams in the given configuration. This stream can be used for adding thread-safety to an arbitrary non-thread-safe stream implementation. For example "lock,stdout" configuration is equivalent to "lstdout".</li>
<li>"null" - silently drop any reported issue.</li>
<li>"throw" - apply the C++ throw operator to the reported issue</li>
<li>"abort" - calls abort() function for any issue reported</li>
<li>"exit" - calls exit() function for any issue reported</li>
<li>"filter(A,B,!C,...)" - pass through only issues, which have either A or B and don't have C qualifier</li>
<li>"rfilter(RA,RB,!RC,...)" - the same as "filter" stream but treats all the given parameters as regular expressions.</li>
<li>"throttle(initial_threshold, time_interval)" - rejects the same issues reported within the <b>time_interval</b> after passing through the <b>initial_threshold</b> number of them.</li>
</ul>
<h1><a class="anchor" id="autotoc_md372"></a>
Custom Stream Implementation</h1>
<p>While ERS provides a set of basic stream implementations one can also implement a custom one if this is required. Custom streams can be plugged into any existing application which is using ERS without recompiling this application.</p>
<h2><a class="anchor" id="autotoc_md373"></a>
Implementing a Custom Stream</h2>
<p>In order to provide a new custom stream implementation one has to declare a sub-class of the <a class="el" href="classers_1_1OutputStream.html" title="ERS abstract output stream interface.">ers::OutputStream</a> class and implement its pure virtual method called <b>write</b>. Here is an example of how this is done by the FilterStream stream implementation:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div>
<div class="line"><a class="code hl_function" href="classers_1_1FilterStream.html#a27c3ff02a6a4bd0b48b429859dc0392f">ers::FilterStream::write</a>( <span class="keyword">const</span> <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> &amp; issue )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> ( <a class="code hl_function" href="classers_1_1FilterStream.html#ab54184e5f97d93ff7d92762f26f49b8e">is_accepted</a>( issue ) ) {</div>
<div class="line">        <a class="code hl_function" href="classers_1_1OutputStream.html#ab6f795462d73c9faba8e8dffec61e1d1">chained</a>().<a class="code hl_function" href="classers_1_1OutputStream.html#a338b2f400821118bda449d35d2f29c0a">write</a>( issue );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassers_1_1FilterStream_html_a27c3ff02a6a4bd0b48b429859dc0392f"><div class="ttname"><a href="classers_1_1FilterStream.html#a27c3ff02a6a4bd0b48b429859dc0392f">ers::FilterStream::write</a></div><div class="ttdeci">void write(const Issue &amp;issue) override</div></div>
<div class="ttc" id="aclassers_1_1FilterStream_html_ab54184e5f97d93ff7d92762f26f49b8e"><div class="ttname"><a href="classers_1_1FilterStream.html#ab54184e5f97d93ff7d92762f26f49b8e">ers::FilterStream::is_accepted</a></div><div class="ttdeci">bool is_accepted(const ers::Issue &amp;issue)</div></div>
<div class="ttc" id="aclassers_1_1OutputStream_html_a338b2f400821118bda449d35d2f29c0a"><div class="ttname"><a href="classers_1_1OutputStream.html#a338b2f400821118bda449d35d2f29c0a">ers::OutputStream::write</a></div><div class="ttdeci">virtual void write(const Issue &amp;issue)=0</div></div>
<div class="ttc" id="aclassers_1_1OutputStream_html_ab6f795462d73c9faba8e8dffec61e1d1"><div class="ttname"><a href="classers_1_1OutputStream.html#ab6f795462d73c9faba8e8dffec61e1d1">ers::OutputStream::chained</a></div><div class="ttdeci">OutputStream &amp; chained()</div><div class="ttdef"><b>Definition</b> <a href="OutputStream_8cpp_source.html#l00018">OutputStream.cpp:18</a></div></div>
</div><!-- fragment --><p>An implementation of the <b><a class="el" href="classers_1_1OutputStream.html#a338b2f400821118bda449d35d2f29c0a">ers::OutputStream::write</a></b> function must decide whether to pass the given issue to the next stream in the chain or not. If a custom stream does not provide any filtering functionality then it shall always pass the input message to the next stream by using the <b>chained().write( issue )</b> code.</p>
<h2><a class="anchor" id="autotoc_md374"></a>
Registering a Custom Stream</h2>
<p>In order to register and use a custom ERS stream implementation one can use a dedicated macro called <b>ERS_REGISTER_STREAM</b> in the following way:</p>
<div class="fragment"><div class="line">ERS_REGISTER_OUTPUT_STREAM( ers::FilterStream, &quot;filter&quot;, format )</div>
</div><!-- fragment --><p>The first parameter of this macro is the name of the class which implements the new stream; the second one gives a new stream name to be used in ERS stream configurations (this is the name which one can put to the <b>DUNEDAQ_ERS_&lt;SEVERITY&gt;</b> environment variables); and the last parameter is a placeholder for the stream class constructor parameters. If the constructor of the new custom stream does not require parameters then last field of this macro should be left empty.</p>
<h2><a class="anchor" id="autotoc_md375"></a>
Using Custom Stream</h2>
<p>In order to use a custom stream one has to build a new shared library from the class that implements this stream and pass this library to ERS by setting its name to the <b>DUNEDAQ_ERS_STREAM_LIBS</b> environment variable. For example if this macro is set to the following value:</p>
<div class="fragment"><div class="line">export  DUNEDAQ_ERS_STREAM_LIBS=MyCustomFilter</div>
</div><!-- fragment --><p>then ERS will be looking for the libMyCustomFilter.so library in all the directories which appear in the <b>LD_LIBRARY_PATH</b> environment variable.</p>
<h1><a class="anchor" id="autotoc_md376"></a>
Error Reporting in Multi-threaded Applications</h1>
<p>ERS can be used for error reporting in multi-threaded applications. As C++ language does not provide a way of passing exceptions across thread boundaries, ERS provides the <b><a class="el" href="namespaceers.html#a4f31fc9762e793d6244e0bdc8a37d4cc">ers::set_issue_catcher</a></b> function to overcome this limitation. When one of the threads of a software application catches an issue it can send it to one of the the ERS streams using <b><a class="el" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>,</b> <b><a class="el" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a></b> or <b><a class="el" href="namespaceers.html#a1f13d0d03ff2e1c3f3b2a9c388a20648">ers::warning</a></b> functions. If no error catcher thread is installed in this application the new issue will be forwarded to the respective ERS stream implementations according to the stream configuration. Otherwise if a custom issue catcher is installed the issue will be passed to the dedicated thread which will call the custom error catcher function.</p>
<h2><a class="anchor" id="autotoc_md377"></a>
Setting up an Error Catcher</h2>
<p>An error catcher should be installed by calling the <b><a class="el" href="namespaceers.html#a4f31fc9762e793d6244e0bdc8a37d4cc">ers::set_issue_catcher</a></b> function and passing it a function object as parameter. This function object will be executed in the context of a dedicated thread (created by the <b><a class="el" href="namespaceers.html#a4f31fc9762e793d6244e0bdc8a37d4cc">ers::set_issue_catcher</a></b> function) for every issue which is reported by the current application to <a class="el" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a>, <a class="el" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a> and <a class="el" href="namespaceers.html#a1f13d0d03ff2e1c3f3b2a9c388a20648">ers::warning</a> streams. The parameter of the <a class="el" href="namespaceers.html#a4f31fc9762e793d6244e0bdc8a37d4cc">ers::set_issue_catcher</a> is of the <b>std::function&lt;void</b> ( const <a class="el" href="classers_1_1Issue.html" title="Base class for any user define issue.">ers::Issue</a> &amp; )&gt; type which allows to use plain C-style functions as well as C++ member functions for implementing a custom error catcher. For example one can define an error catcher as a member function of a certain class:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>IssueCatcher {</div>
<div class="line">   <span class="keywordtype">void</span> handler( <span class="keyword">const</span> <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> &amp; issue ) {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;IssueCatcher has been called: &quot;</span> &lt;&lt; issue &lt;&lt; std::endl;</div>
<div class="line">   }</div>
<div class="line">};</div>
</div><!-- fragment --><p>This error catcher can be registered with ERS in the following way:</p>
<div class="fragment"><div class="line">IssueCatcher * catcher = <span class="keyword">new</span> IssueCatcher();</div>
<div class="line"><a class="code hl_class" href="classers_1_1IssueCatcherHandler.html">ers::IssueCatcherHandler</a> * handler;</div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    handler = <a class="code hl_function" href="namespaceers.html#a4f31fc9762e793d6244e0bdc8a37d4cc">ers::set_issue_catcher</a>( std::bind( &amp;IssueCatcher::handler, catcher, std::placeholders::_1 ) );</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span>(ers::IssueCatcherAlreadySet &amp; ex){</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="aclassers_1_1IssueCatcherHandler_html"><div class="ttname"><a href="classers_1_1IssueCatcherHandler.html">ers::IssueCatcherHandler</a></div><div class="ttdoc">Implements issue catcher lifetime management.</div><div class="ttdef"><b>Definition</b> <a href="IssueCatcherHandler_8hpp_source.html#l00029">IssueCatcherHandler.hpp:30</a></div></div>
<div class="ttc" id="anamespaceers_html_a4f31fc9762e793d6244e0bdc8a37d4cc"><div class="ttname"><a href="namespaceers.html#a4f31fc9762e793d6244e0bdc8a37d4cc">ers::set_issue_catcher</a></div><div class="ttdeci">IssueCatcherHandler * set_issue_catcher(const std::function&lt; void(const ers::Issue &amp;)&gt; &amp;catcher)</div><div class="ttdef"><b>Definition</b> <a href="ers_8hpp_source.html#l00060">ers.hpp:60</a></div></div>
</div><!-- fragment --><p>Note that the error handling catcher can be set only once for the lifetime of an application. An attempt to set it again will fail and the <b>ers::IssueCatcherAlreadySet</b> exception will be thrown.</p>
<p>To unregister a previously installed issue catcher one need to destroy the handler that is returned by the <b><a class="el" href="namespaceers.html#a4f31fc9762e793d6244e0bdc8a37d4cc">ers::set_issue_catcher</a></b> function using <b>delete</b> operator:</p>
<div class="fragment"><div class="line"><span class="keyword">delete</span> handler;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md378"></a>
Receiving Issues Across Application Boundaries</h1>
<p>There is a specific implementation of ERS input and output streams which allows to exchange issue across application boundaries, i.e. one process may receive ERS issues produces by another processes. The following example shows how to do that:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="InputStream_8hpp.html">ers/InputStream.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ers_8hpp.html">ers/ers.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>MyIssueReceiver : <span class="keyword">public</span> <a class="code hl_class" href="classers_1_1IssueReceiver.html">ers::IssueReceiver</a> {</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classers_1_1IssueReceiver.html#a9d61452af3d0085baf70e5c4e56ee924">receive</a>( <span class="keyword">const</span> <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> &amp; issue ) {</div>
<div class="line">        std::cout &lt;&lt; issue &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">MyIssueReceiver * receiver = <span class="keyword">new</span> MyIssueReceiver;</div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    <a class="code hl_function" href="classers_1_1StreamManager.html#a5fbf4572e877938caa7a30d9ea492df2">ers::StreamManager::instance</a>().<a class="code hl_function" href="classers_1_1StreamManager.html#ad47ffbef6ef20ac6114b68c5cb14b66c">add_receiver</a>( <span class="stringliteral">&quot;mts&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>, receiver );</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span>( <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> &amp; ex ) {</div>
<div class="line">    <a class="code hl_function" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a>( ex );</div>
<div class="line">}</div>
<div class="ttc" id="aInputStream_8hpp_html"><div class="ttname"><a href="InputStream_8hpp.html">InputStream.hpp</a></div></div>
<div class="ttc" id="aclassers_1_1IssueReceiver_html"><div class="ttname"><a href="classers_1_1IssueReceiver.html">ers::IssueReceiver</a></div><div class="ttdoc">ERS Issue receiver interface.</div><div class="ttdef"><b>Definition</b> <a href="IssueReceiver_8hpp_source.html#l00030">IssueReceiver.hpp:31</a></div></div>
<div class="ttc" id="aclassers_1_1IssueReceiver_html_a9d61452af3d0085baf70e5c4e56ee924"><div class="ttname"><a href="classers_1_1IssueReceiver.html#a9d61452af3d0085baf70e5c4e56ee924">ers::IssueReceiver::receive</a></div><div class="ttdeci">virtual void receive(const Issue &amp;issue)=0</div><div class="ttdoc">Is called when a new issue is received.</div></div>
<div class="ttc" id="aclassers_1_1StreamManager_html_a5fbf4572e877938caa7a30d9ea492df2"><div class="ttname"><a href="classers_1_1StreamManager.html#a5fbf4572e877938caa7a30d9ea492df2">ers::StreamManager::instance</a></div><div class="ttdeci">static StreamManager &amp; instance()</div><div class="ttdoc">return the singleton</div><div class="ttdef"><b>Definition</b> <a href="StreamManager_8cpp_source.html#l00151">StreamManager.cpp:151</a></div></div>
<div class="ttc" id="aclassers_1_1StreamManager_html_ad47ffbef6ef20ac6114b68c5cb14b66c"><div class="ttname"><a href="classers_1_1StreamManager.html#ad47ffbef6ef20ac6114b68c5cb14b66c">ers::StreamManager::add_receiver</a></div><div class="ttdeci">void add_receiver(const std::string &amp;stream, const std::string &amp;filter, ers::IssueReceiver *receiver)</div><div class="ttdef"><b>Definition</b> <a href="StreamManager_8cpp_source.html#l00197">StreamManager.cpp:197</a></div></div>
<div class="ttc" id="aers_8hpp_html"><div class="ttname"><a href="ers_8hpp.html">ers.hpp</a></div></div>
<div class="ttc" id="anamespaceers_html_ae546de6c000e3e8eecda0c9fa9d78857"><div class="ttname"><a href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a></div><div class="ttdeci">void fatal(const Issue &amp;issue)</div><div class="ttdef"><b>Definition</b> <a href="ers_8hpp_source.html#l00088">ers.hpp:88</a></div></div>
</div><!-- fragment --><p>The MyIssueReceiver instance will be getting all messages, which are sent to the "mts" stream implementation by all applications working in the current TDAQ partition whose name will be taken from the <b>DUNEDAQ_PARTITION</b> environment variable. Alternatively one may pass partition name explicitly via the "mts" stream parameters list:</p>
<div class="fragment"><div class="line">MyIssueReceiver * receiver = <span class="keyword">new</span> MyIssueReceiver;</div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    <a class="code hl_function" href="classers_1_1StreamManager.html#a5fbf4572e877938caa7a30d9ea492df2">ers::StreamManager::instance</a>().<a class="code hl_function" href="classers_1_1StreamManager.html#ad47ffbef6ef20ac6114b68c5cb14b66c">add_receiver</a>( <span class="stringliteral">&quot;mts&quot;</span>, {<span class="stringliteral">&quot;my partition name&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>}, receiver );</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span>( <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> &amp; ex ) {</div>
<div class="line">    <a class="code hl_function" href="namespaceers.html#ae546de6c000e3e8eecda0c9fa9d78857">ers::fatal</a>( ex );</div>
<div class="line">}</div>
</div><!-- fragment --><p>To cancel a previously made subscription one should use the <b><a class="el" href="classers_1_1StreamManager.html#af818da393a4c5fbf0daad75867525fea">ers::StreamManager::remove_receiver</a></b> function and giving it a pointer to the corresponding receiver object, e.g.:</p>
<div class="fragment"><div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    <a class="code hl_function" href="classers_1_1StreamManager.html#a5fbf4572e877938caa7a30d9ea492df2">ers::StreamManager::instance</a>().<a class="code hl_function" href="classers_1_1StreamManager.html#af818da393a4c5fbf0daad75867525fea">remove_receiver</a>( receiver );</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span>( <a class="code hl_class" href="classers_1_1Issue.html">ers::Issue</a> &amp; ex ) {</div>
<div class="line">    <a class="code hl_function" href="namespaceers.html#aff4eee77205a91301c3c942ae1de25c6">ers::error</a>( ex );</div>
<div class="line">}</div>
<div class="ttc" id="aclassers_1_1StreamManager_html_af818da393a4c5fbf0daad75867525fea"><div class="ttname"><a href="classers_1_1StreamManager.html#af818da393a4c5fbf0daad75867525fea">ers::StreamManager::remove_receiver</a></div><div class="ttdeci">void remove_receiver(ers::IssueReceiver *receiver)</div><div class="ttdef"><b>Definition</b> <a href="StreamManager_8cpp_source.html#l00221">StreamManager.cpp:221</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 24 2024 for DUNE-DAQ by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
