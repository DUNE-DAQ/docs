<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: ADCSimpleWindow</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">ADCSimpleWindow</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md381"></a></p><ul>
<li>A “next-to-most-simple” triggering algorithm to exercise the TP chain.</li>
<li>Look at the total ADC of incoming TPs in a given time window (<code>window_length</code>), trigger if that total goes above some user defined threshold (<code>adc_threshold</code>). Both <code>window_length</code> and <code>adc_threshold</code> are configurable members of the <code>TAMakerADCSimpleWindow</code> class. Defaults obtained based on the data in <code>tps_link_11.txt</code>.</li>
<li>All of the logic is implemented in the <code>TAMakerADCSimpleWindow</code> class. A nested class called <code>Window</code> monitors incoming TPs (which are time ordered).</li>
<li>When a particular window exceeds threshold, <code>TAMakerADCSimpleWindow::construct_ta()</code> constructs a <code>TriggerActivity</code>. This is enough (eventually) to request data to be read out. The <code>TCMakerADCSimpleWindowAlgorithm</code> class simply constructs trigger candidates one-for-one from the trigger activities.</li>
<li>Note that an activity will only be constructed once the window is full length even if the total ADC goes above the threshold beforehand. For example, if the user defines a window 1 ms in length and the ADC threshold is reached after 0.5 ms, a candidate will only be constructed once a TP is received with a start time 1 ms after the first TP in that window.</li>
<li>Can use <code>faketp_chain</code> confgen to generate the configuration to run the fake TP chain with the <code>ADCSimpleWindow</code> algorithm: <div class="fragment"><div class="line">python -m trigger.faketp_chain -a TAMakerADCSimpleWindowPlugin -A &quot;dict(window_length=100000,adc_threshold=1000000)&quot; -c TCMakerADCSimpleWindowPlugin -f tps_link_11.txt faketp_chain_ADCSimpleWindow</div>
</div><!-- fragment --></li>
<li>Then to run: <div class="fragment"><div class="line">python -m nanorc config_dir boot init conf start 1 resume wait 60 stop</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md382"></a>
&lt;tt&gt;Window&lt;/tt&gt;: &lt;tt&gt;TAMakerADCSimpleWindow&lt;/tt&gt; Nested Class:</h1>
<ul>
<li>Most of the logic is dealt with by the <code>Window</code> class, a class nested inside <code>TAMakerADCSimpleWindow</code>.</li>
<li>It contains three member functions and five functions. <code>operator&lt;&lt;</code> is also defined. The following explanations can be used to interpret the accompanying flow chart.<ul>
<li><code>time_start</code>: Start time of the first TP chronologically in the window.</li>
<li><code>adc_integral</code>: Total ADC of the TPs in the window.</li>
<li><code>tp_list</code>: A vector of TPs in the window.</li>
<li><code>is_empty()</code>: If the vector of TPs is empty, returns true, else false.</li>
<li><code>clear()</code>: Clears the vector of TPs.</li>
<li><code>move()</code>: Find all of the TPs in the current window which need to be removed if the input TP is to be added and the earliest and latest TPs in the window aren’t separated by more than <code>window_length</code>. The earliest TPs in the window are removed (their ADC contribution subtracted) until this condition is satisfied. <code>time_start</code> for the window is then set to what is now the first TP start time. Note that in the case that the input TP is further away than 1 <code>window_length</code> from the latest TP in the window, the window is reset with the input TP.</li>
<li><code>reset():</code> Clear the TP list, restart the ADC sum, set the start time of the window to the start time of the input TP. Add, the input TP to the window TP list.</li>
<li><code>add()</code>: Add input TP to window TP list and its ADC to window ADC total.</li>
</ul>
</li>
</ul>
<p><img src="AlgorithmFlowChart.png" alt="" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 24 2024 for DUNE-DAQ by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
