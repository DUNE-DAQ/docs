<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: /github/workspace/dev_area/sourcecode/wibmod/src/WIB1/WIB_CDS.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c86d4bc79f792d6c7f006f9966b5d7f5.html">dev_area</a></li><li class="navelem"><a class="el" href="dir_e594a494f7a60e5bf534551500b27d35.html">sourcecode</a></li><li class="navelem"><a class="el" href="dir_3fc12f475e1688c84a4a04c37f949566.html">wibmod</a></li><li class="navelem"><a class="el" href="dir_8881d0f15cea1a09fe81c83e72103db0.html">src</a></li><li class="navelem"><a class="el" href="dir_62147fa7bba7e37180261b097456ce8e.html">WIB1</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">WIB_CDS.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="WIB__CDS_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="WIB_8hh.html">wibmod/WIB1/WIB.hh</a>&quot;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="preprocessor">#include &lt;unistd.h&gt;</span> <span class="comment">// usleep</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span> </div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#include &quot;<a class="code" href="WIBException_8hh.html">wibmod/WIB1/WIBException.hh</a>&quot;</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span> </div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno"><a class="line" href="WIB__CDS_8cpp.html#aa507cfd53115579c3fd04ddec12b9960">    6</a></span><span class="preprocessor">#define COURSE_DATARATE_SIZE 232</span></div>
<div class="foldopen" id="foldopen00007" data-start="{" data-end="};">
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno"><a class="line" href="WIB__CDS_8cpp.html#a5c4a8a40dd02218938a09a4121e9d333">    7</a></span><span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="WIB__CDS_8cpp.html#a5c4a8a40dd02218938a09a4121e9d333">courseDataRates</a>[<a class="code hl_define" href="WIB__CDS_8cpp.html#aa507cfd53115579c3fd04ddec12b9960">COURSE_DATARATE_SIZE</a>] = {5.3745e+06,5.3741e+06,5.4793e+06,5.5912e+06,5.7111e+06,5.8391e+06,5.9760e+06,6.1215e+06,6.2780e+06,6.4565e+06,6.6391e+06,6.8372e+06,7.0520e+06,7.2868e+06,7.5424e+06,7.8220e+06,7.6663e+06,7.6659e+06,7.8217e+06,7.9880e+06,8.1667e+06,8.3570e+06,8.5616e+06,8.7805e+06,9.0166e+06,9.2849e+06,9.5608e+06,9.8591e+06,1.0183e+07,1.0535e+07,1.0918e+07,1.1332e+07,1.0749e+07,1.0748e+07,1.0959e+07,1.1182e+07,1.1422e+07,1.1678e+07,1.1952e+07,1.2243e+07,1.2556e+07,1.2913e+07,1.3278e+07,1.3674e+07,1.4104e+07,1.4574e+07,1.5085e+07, </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>1.5644e+07,1.5333e+07,1.5332e+07,1.5643e+07,1.5976e+07,1.6333e+07,1.6714e+07,1.7123e+07,1.7561e+07,1.8033e+07,1.8570e+07,1.9122e+07,1.9718e+07,2.0367e+07,2.1070e+07,2.1835e+07,2.2664e+07,2.1498e+07,2.1496e+07,2.1917e+07,2.2365e+07,2.2844e+07,2.3357e+07,2.3904e+07,2.4486e+07,2.5112e+07,2.5826e+07,2.6556e+07,2.7349e+07,2.8208e+07,2.9147e+07,3.0170e+07,3.1288e+07,3.0665e+07,3.0664e+07,3.1287e+07,3.1952e+07,3.2667e+07,3.3428e+07,3.4246e+07,3.5122e+07,3.6066e+07,3.7140e+07,3.8243e+07,3.9436e+07,4.0733e+07,4.2140e+07, </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>4.3671e+07,4.5328e+07,4.2996e+07,4.2993e+07,4.3834e+07,4.4729e+07,4.5688e+07,4.6713e+07,4.7808e+07,4.8972e+07,5.0224e+07,5.1652e+07,5.3113e+07,5.4698e+07,5.6416e+07,5.8295e+07,6.0339e+07,6.2576e+07,6.1331e+07,6.1328e+07,6.2574e+07,6.3904e+07,6.5334e+07,6.6856e+07,6.8493e+07,7.0244e+07,7.2133e+07,7.4279e+07,7.6486e+07,7.8872e+07,8.1467e+07,8.4279e+07,8.7341e+07,9.0657e+07,8.5991e+07,8.5986e+07,8.7668e+07,8.9458e+07,9.1377e+07,9.3426e+07,9.5616e+07,9.7944e+07,1.0045e+08,1.0330e+08,1.0623e+08,1.0940e+08,1.1283e+08, </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>1.1659e+08,1.2068e+08,1.2515e+08,1.2266e+08,1.2266e+08,1.2515e+08,1.2781e+08,1.3067e+08,1.3371e+08,1.3699e+08,1.4049e+08,1.4427e+08,1.4856e+08,1.5297e+08,1.5774e+08,1.6293e+08,1.6856e+08,1.7468e+08,1.8131e+08,1.7198e+08,1.7197e+08,1.7534e+08,1.7892e+08,1.8275e+08,1.8685e+08,1.9123e+08,1.9589e+08,2.0089e+08,2.0661e+08,2.1245e+08,2.1879e+08,2.2566e+08,2.3318e+08,2.4136e+08,2.5030e+08,2.4532e+08,2.4531e+08,2.5029e+08,2.5562e+08,2.6134e+08,2.6742e+08,2.7397e+08,2.8098e+08,2.8853e+08,2.9712e+08,3.0594e+08,3.1549e+08, </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span>3.2587e+08,3.3712e+08,3.4936e+08,3.6263e+08,3.4397e+08,3.4394e+08,3.5067e+08,3.5783e+08,3.6551e+08,3.7370e+08,3.8247e+08, </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>3.9177e+08,4.0179e+08,4.1322e+08,4.2490e+08,4.3758e+08,4.5133e+08,4.6636e+08,4.8272e+08,5.0061e+08,4.9064e+08,4.9062e+08, </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>5.0059e+08,5.1123e+08,5.2267e+08,5.3485e+08,5.4794e+08,5.6195e+08,5.7706e+08,5.9423e+08,6.1189e+08,6.3098e+08,6.5173e+08, </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>                     6.7423e+08,6.9873e+08,7.2525e+08,6.8793e+08,6.8789e+08,7.0135e+08,7.1567e+08,7.3102e+08,7.4741e+08,7.6493e+08,7.8355e+08};</div>
</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="foldopen" id="foldopen00017" data-start="{" data-end="}">
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno"><a class="line" href="classWIB.html#afb5815b41d2fbd78687171c9948d5629">   17</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWIB.html#afb5815b41d2fbd78687171c9948d5629">WIB::WriteDTS_CDS</a>(uint16_t address,uint32_t value,uint8_t byte_count,<span class="keywordtype">bool</span> ignore_error){</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>  <a class="code hl_function" href="classWIBBase.html#ab04ba935fc8cfc74eaace8b5dd8c984c">WriteI2C</a>(<span class="stringliteral">&quot;DTS.CDS.I2C&quot;</span>,address,value,byte_count,ignore_error);</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>}</div>
</div>
<div class="foldopen" id="foldopen00020" data-start="{" data-end="}">
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno"><a class="line" href="classWIB.html#a99fd5ea65e2d224ec88550261ec66f0f">   20</a></span>uint32_t <a class="code hl_function" href="classWIB.html#a99fd5ea65e2d224ec88550261ec66f0f">WIB::ReadDTS_CDS</a>(uint16_t address,uint8_t byte_count){</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="classWIBBase.html#ad5878023661817ee83b873db2470e456">ReadI2C</a>(<span class="stringliteral">&quot;DTS.CDS.I2C&quot;</span>,address,byte_count);</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>}</div>
</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="foldopen" id="foldopen00024" data-start="{" data-end="}">
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno"><a class="line" href="classWIB.html#aafb7beccff730f2cd3641ae63f34dedf">   24</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classWIB.html#aafb7beccff730f2cd3641ae63f34dedf">WIB::ConfigureDTSCDS</a>(uint8_t source){</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>  <span class="keywordflow">if</span>(source &gt; 1){</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>    BUException::WIB_BAD_ARGS e;</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>    e.Append(<span class="stringliteral">&quot;Bad DTS CDS clock source&quot;</span>);</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>    <span class="keywordflow">throw</span> e;</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>  }</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>  <span class="comment">//Set timing system source (FP:0 BP:1)</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>  <a class="code hl_function" href="classWIBBase.html#a64a67538bc8d70f7647963437133f4bd">WriteWithRetry</a>(<span class="stringliteral">&quot;DTS.CDS.INPUT_SELECT&quot;</span>,source);</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>  <span class="comment">//Reset the I2C firmware</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>  <a class="code hl_function" href="classWIBBase.html#a64a67538bc8d70f7647963437133f4bd">WriteWithRetry</a>(<span class="stringliteral">&quot;DTS.CDS.I2C.RESET&quot;</span>,1);</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>  <span class="comment">//Reset the CDS chip (ADN2814)  </span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>  <a class="code hl_function" href="classWIB.html#afb5815b41d2fbd78687171c9948d5629">WriteDTS_CDS</a>(0x9,0x20,1);</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>  usleep(500000);</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>  <span class="comment">//Reset the I2C firmware</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>  <a class="code hl_function" href="classWIBBase.html#a64a67538bc8d70f7647963437133f4bd">WriteWithRetry</a>(<span class="stringliteral">&quot;DTS.CDS.I2C.RESET&quot;</span>,1);</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>  <span class="comment">//Un reset</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>  <a class="code hl_function" href="classWIB.html#afb5815b41d2fbd78687171c9948d5629">WriteDTS_CDS</a>(0x9,0x00,1,<span class="keyword">true</span>);</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>  <span class="comment">//Reset the I2C firmware</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>  <a class="code hl_function" href="classWIBBase.html#a64a67538bc8d70f7647963437133f4bd">WriteWithRetry</a>(<span class="stringliteral">&quot;DTS.CDS.I2C.RESET&quot;</span>,1);</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>  usleep(1000000);</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>  <span class="comment">//read bits 8 downto 1 from reg 3</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>  uint16_t dataRateLookup = uint16_t(<a class="code hl_function" href="classWIB.html#a99fd5ea65e2d224ec88550261ec66f0f">ReadDTS_CDS</a>(0x3,1)) &lt;&lt; 1;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>  <span class="comment">//Read bit 0 from reg 4</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>  dataRateLookup |= uint16_t(<a class="code hl_function" href="classWIB.html#a99fd5ea65e2d224ec88550261ec66f0f">ReadDTS_CDS</a>(0x4,1))&amp;0x1;</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>  <span class="keywordflow">if</span>(dataRateLookup &gt;=<a class="code hl_define" href="WIB__CDS_8cpp.html#aa507cfd53115579c3fd04ddec12b9960">COURSE_DATARATE_SIZE</a>){</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>  }</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="WIB__CDS_8cpp.html#a5c4a8a40dd02218938a09a4121e9d333">courseDataRates</a>[dataRateLookup];</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>}</div>
</div>
<div class="ttc" id="aWIBException_8hh_html"><div class="ttname"><a href="WIBException_8hh.html">WIBException.hh</a></div></div>
<div class="ttc" id="aWIB_8hh_html"><div class="ttname"><a href="WIB_8hh.html">WIB.hh</a></div></div>
<div class="ttc" id="aWIB__CDS_8cpp_html_a5c4a8a40dd02218938a09a4121e9d333"><div class="ttname"><a href="WIB__CDS_8cpp.html#a5c4a8a40dd02218938a09a4121e9d333">courseDataRates</a></div><div class="ttdeci">static float courseDataRates[COURSE_DATARATE_SIZE]</div><div class="ttdef"><b>Definition</b> <a href="WIB__CDS_8cpp_source.html#l00007">WIB_CDS.cpp:7</a></div></div>
<div class="ttc" id="aWIB__CDS_8cpp_html_aa507cfd53115579c3fd04ddec12b9960"><div class="ttname"><a href="WIB__CDS_8cpp.html#aa507cfd53115579c3fd04ddec12b9960">COURSE_DATARATE_SIZE</a></div><div class="ttdeci">#define COURSE_DATARATE_SIZE</div><div class="ttdef"><b>Definition</b> <a href="WIB__CDS_8cpp_source.html#l00006">WIB_CDS.cpp:6</a></div></div>
<div class="ttc" id="aclassWIBBase_html_a64a67538bc8d70f7647963437133f4bd"><div class="ttname"><a href="classWIBBase.html#a64a67538bc8d70f7647963437133f4bd">WIBBase::WriteWithRetry</a></div><div class="ttdeci">void WriteWithRetry(uint16_t address, uint32_t value)</div><div class="ttdef"><b>Definition</b> <a href="WIBBase_8cpp_source.html#l00129">WIBBase.cpp:129</a></div></div>
<div class="ttc" id="aclassWIBBase_html_ab04ba935fc8cfc74eaace8b5dd8c984c"><div class="ttname"><a href="classWIBBase.html#ab04ba935fc8cfc74eaace8b5dd8c984c">WIBBase::WriteI2C</a></div><div class="ttdeci">void WriteI2C(std::string const &amp;base_address, uint16_t I2C_address, uint32_t data, uint8_t byte_count=4, bool ignore_error=false)</div><div class="ttdef"><b>Definition</b> <a href="WIBBase_8cpp_source.html#l00069">WIBBase.cpp:69</a></div></div>
<div class="ttc" id="aclassWIBBase_html_ad5878023661817ee83b873db2470e456"><div class="ttname"><a href="classWIBBase.html#ad5878023661817ee83b873db2470e456">WIBBase::ReadI2C</a></div><div class="ttdeci">uint32_t ReadI2C(std::string const &amp;base_address, uint16_t I2C_aaddress, uint8_t byte_count=4)</div><div class="ttdef"><b>Definition</b> <a href="WIBBase_8cpp_source.html#l00039">WIBBase.cpp:39</a></div></div>
<div class="ttc" id="aclassWIB_html_a99fd5ea65e2d224ec88550261ec66f0f"><div class="ttname"><a href="classWIB.html#a99fd5ea65e2d224ec88550261ec66f0f">WIB::ReadDTS_CDS</a></div><div class="ttdeci">uint32_t ReadDTS_CDS(uint16_t address, uint8_t byte_count=4)</div><div class="ttdef"><b>Definition</b> <a href="WIB__CDS_8cpp_source.html#l00020">WIB_CDS.cpp:20</a></div></div>
<div class="ttc" id="aclassWIB_html_aafb7beccff730f2cd3641ae63f34dedf"><div class="ttname"><a href="classWIB.html#aafb7beccff730f2cd3641ae63f34dedf">WIB::ConfigureDTSCDS</a></div><div class="ttdeci">float ConfigureDTSCDS(uint8_t source=0)</div><div class="ttdef"><b>Definition</b> <a href="WIB__CDS_8cpp_source.html#l00024">WIB_CDS.cpp:24</a></div></div>
<div class="ttc" id="aclassWIB_html_afb5815b41d2fbd78687171c9948d5629"><div class="ttname"><a href="classWIB.html#afb5815b41d2fbd78687171c9948d5629">WIB::WriteDTS_CDS</a></div><div class="ttdeci">void WriteDTS_CDS(uint16_t address, uint32_t value, uint8_t byte_count=4, bool ignore_error=false)</div><div class="ttdef"><b>Definition</b> <a href="WIB__CDS_8cpp_source.html#l00017">WIB_CDS.cpp:17</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 24 2024 for DUNE-DAQ by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
