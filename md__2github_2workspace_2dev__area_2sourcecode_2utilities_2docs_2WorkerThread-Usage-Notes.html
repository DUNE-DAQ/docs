<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: About utilities::WorkerThread</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">About utilities::WorkerThread</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md336"></a> WorkerThread defines a std::thread which runs the do_work() function as well as methods to start and stop that thread. It is intended to help reduce code duplication for the common task of starting and stopping threads.</p>
<h1><a class="anchor" id="autotoc_md337"></a>
Instantiation</h1>
<p>WorkerThread's constructor takes a <code>std::function&lt;void(std::atomic&lt;bool&gt;&amp;) do_work</code> parameter. This corresponds to the function that should be run in the thread when it is started. The single parameter is used to indicate that the thread should conclude its work and exit when false. (i.e. threads are expected to have a <code>while(running_flag)</code> loop in their <code>void do_work(std::atomic&lt;bool&gt;&amp; running_flag)</code> method.)</p>
<h1><a class="anchor" id="autotoc_md338"></a>
Starting the worker thread</h1>
<p>WorkerThread defines a <code>start_working_thread</code> method which should be called to start the working thread. This method takes a single argument which is the desired pthread name for the working thread. This name is limited to 15 characters, over-long names will result in the new thread sharing the name of the calling process. The set name will not be immediately available within the <code>do_work</code> method and should not be relied upon.</p>
<h1><a class="anchor" id="autotoc_md339"></a>
Stopping the worker thread</h1>
<p>WorkerThread defines a <code>stop_working_thread</code> method which will set the atomic boolean running flag to false, indicating that the worker thread should exit. It will then attempt to join the working thread. The contract with the do_work method is thus that when the running flag is set to false, the method should conclude its work in a timely fashion.</p>
<h1><a class="anchor" id="autotoc_md340"></a>
Other Notes</h1>
<p>Users of WorkerThread may call the <code>thread_running()</code> method to determine if <code>start_working_thread</code> has been called. Since the method run by WorkerThread is in the caller's scope, the working method has access to all state variables in that scope. Beware that most STL container types are not intrinsically thread-safe, and care should be used when accessing shared data. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 24 2024 for DUNE-DAQ by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
