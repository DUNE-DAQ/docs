<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Introduction</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md220"></a> With the connectivity service changes, it is now possible for DAQ modules to generate their own connection names, as long as both ends of the connection agree on the naming convention in use. This document shows an example of using these dynamic connection names for the TriggerRecordBuilder.</p>
<h1><a class="anchor" id="autotoc_md221"></a>
Configuration-based</h1>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div>
<div class="line">TriggerRecordBuilder::init(<span class="keyword">const</span> data_t&amp; init_data)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="logging_2include_2logging_2Logging_8hpp.html#a8c6732348bcdf3758aac3d18eb3995b9">TLOG_DEBUG</a>(<a class="code hl_define" href="hsilibs_2include_2hsilibs_2Issues_8hpp.html#ac8430d5ad44fe13fd4cb4fc822b24bf2">TLVL_ENTER_EXIT_METHODS</a>) &lt;&lt; get_name() &lt;&lt; <span class="stringliteral">&quot;: Entering init() method&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//--------------------------------</span></div>
<div class="line">  <span class="comment">// Get single queues</span></div>
<div class="line">  <span class="comment">//---------------------------------</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> ci = appfwk::connection_index(init_data, { <span class="stringliteral">&quot;trigger_decision_input&quot;</span>, <span class="stringliteral">&quot;trigger_record_output&quot;</span> });</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> iom = iomanager::IOManager::get();</div>
<div class="line">  m_trigger_decision_input = iom-&gt;get_receiver&lt;dfmessages::TriggerDecision&gt;(ci[<span class="stringliteral">&quot;trigger_decision_input&quot;</span>]);</div>
<div class="line">  m_trigger_record_output =</div>
<div class="line">    iom-&gt;get_sender&lt;std::unique_ptr&lt;daqdataformats::TriggerRecord&gt;&gt;(ci[<span class="stringliteral">&quot;trigger_record_output&quot;</span>]);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//----------------------</span></div>
<div class="line">  <span class="comment">// Get dynamic queues</span></div>
<div class="line">  <span class="comment">//----------------------</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set names for the fragment connections</span></div>
<div class="line">  <span class="keyword">auto</span> ini = init_data.get&lt;appfwk::app::ModInit&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// get the names for the fragment connections</span></div>
<div class="line">  <span class="comment">// there is an optional connection, which is the connection to DQM</span></div>
<div class="line">  <span class="comment">// Since it&#39;s optional, we need to loop over all the connections</span></div>
<div class="line">  <span class="comment">// to check if it&#39;s there and act accordingly</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; ref : ini.conn_refs) {</div>
<div class="line">    <span class="keywordflow">if</span> (ref.name.rfind(<span class="stringliteral">&quot;data_fragment_&quot;</span>) == 0) {</div>
<div class="line">      m_fragment_inputs.push_back(iom-&gt;get_receiver&lt;std::unique_ptr&lt;daqdataformats::Fragment&gt;&gt;(ref.uid));</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ref.name == <span class="stringliteral">&quot;mon_connection&quot;</span>) {</div>
<div class="line">      m_mon_receiver = iom-&gt;get_receiver&lt;dfmessages::TRMonRequest&gt;(ref.uid);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="logging_2include_2logging_2Logging_8hpp.html#a8c6732348bcdf3758aac3d18eb3995b9">TLOG_DEBUG</a>(<a class="code hl_define" href="hsilibs_2include_2hsilibs_2Issues_8hpp.html#ac8430d5ad44fe13fd4cb4fc822b24bf2">TLVL_ENTER_EXIT_METHODS</a>) &lt;&lt; get_name() &lt;&lt; <span class="stringliteral">&quot;: Exiting init() method&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="ahsilibs_2include_2hsilibs_2Issues_8hpp_html_ac8430d5ad44fe13fd4cb4fc822b24bf2"><div class="ttname"><a href="hsilibs_2include_2hsilibs_2Issues_8hpp.html#ac8430d5ad44fe13fd4cb4fc822b24bf2">TLVL_ENTER_EXIT_METHODS</a></div><div class="ttdeci">#define TLVL_ENTER_EXIT_METHODS</div><div class="ttdef"><b>Definition</b> <a href="hsilibs_2include_2hsilibs_2Issues_8hpp_source.html#l00021">Issues.hpp:21</a></div></div>
<div class="ttc" id="alogging_2include_2logging_2Logging_8hpp_html_a8c6732348bcdf3758aac3d18eb3995b9"><div class="ttname"><a href="logging_2include_2logging_2Logging_8hpp.html#a8c6732348bcdf3758aac3d18eb3995b9">TLOG_DEBUG</a></div><div class="ttdeci">#define TLOG_DEBUG(lvl,...)</div><div class="ttdef"><b>Definition</b> <a href="logging_2include_2logging_2Logging_8hpp_source.html#l00112">Logging.hpp:112</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md222"></a>
Using dynamic names</h1>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div>
<div class="line">TriggerRecordBuilder::init(<span class="keyword">const</span> data_t&amp; init_data)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="logging_2include_2logging_2Logging_8hpp.html#a8c6732348bcdf3758aac3d18eb3995b9">TLOG_DEBUG</a>(<a class="code hl_define" href="hsilibs_2include_2hsilibs_2Issues_8hpp.html#ac8430d5ad44fe13fd4cb4fc822b24bf2">TLVL_ENTER_EXIT_METHODS</a>) &lt;&lt; get_name() &lt;&lt; <span class="stringliteral">&quot;: Entering init() method&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  m_trigger_decision_input = get_iom_receiver&lt;dfmessages::TriggerDecision&gt;(<span class="stringliteral">&quot;trigger_decisions_for_&quot;</span> + m_this_trb_source_id.to_string());</div>
<div class="line">    m_trigger_record_output = get_iom_sender&lt;std::unique_ptr&lt;daqdataformats::TriggerRecord&gt;&gt;(appfwk::connection_inst(init_data, <span class="stringliteral">&quot;trigger_record_output&quot;</span>));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Only one Fragment input now, maybe change this to a single Receiver?</span></div>
<div class="line">    m_fragment_inputs.push_back(get_iom_receiver&lt;std::unique_ptr&lt;daqdataformats::Fragment&gt;&gt;(<span class="stringliteral">&quot;fragments_for_&quot;</span> + m_this_trb_source_id.to_string())); <span class="comment">// This will also be put into DataRequests, no need for readout to worry about it</span></div>
<div class="line">    </div>
<div class="line">    m_mon_receiver = get_iom_receiver&lt;dfmessages:TRMonRequest&gt;(<span class="stringliteral">&quot;trmon_requests_for_&quot;</span> + m_this_trb_source_id.to_string()); <span class="comment">// No harm in always listening</span></div>
<div class="line">    </div>
<div class="line">  <a class="code hl_define" href="logging_2include_2logging_2Logging_8hpp.html#a8c6732348bcdf3758aac3d18eb3995b9">TLOG_DEBUG</a>(<a class="code hl_define" href="hsilibs_2include_2hsilibs_2Issues_8hpp.html#ac8430d5ad44fe13fd4cb4fc822b24bf2">TLVL_ENTER_EXIT_METHODS</a>) &lt;&lt; get_name() &lt;&lt; <span class="stringliteral">&quot;: Exiting init() method&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md223"></a>
Notes</h1>
<p>Types of Sender/Receiver instances are not changed, so <code>m_trigger_decision_input</code> is still an <code>iomanager::Receiver&lt;dfmessages::TriggerDecision&gt;</code>, and will only receive TriggerDecision objects.</p>
<p>The "Current" style of retrieving connection information from configuration is still perfectly valid, and should be used where appropriate. (For example, the trigger_record_output connection above.)</p>
<p>Names such as "trigger_decsisions_for_" are for human readability, and are not required, as long as the generated portion (e.g. m_this_trb_source_id.to_string()) will be unique <em>for that data type</em>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 24 2024 for DUNE-DAQ by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
