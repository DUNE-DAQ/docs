<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: Action Plans</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Action Plans</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md443"></a> </p>
<h1><a class="anchor" id="autotoc_md444"></a>
Overview</h1>
<p>An ActionPlan defines a series of steps consisting of groups of modules, which are executed in response to a command from CCM. Groups of modules are defined either by module class or by module instances, and the execution of each step is in parallel by default, but can be changed to serial execution if needed. Each ActionPlan is associated with a FSMCommand object, and is run by the appliction when it recieves the corresponding command. If a command is received and no ActionPlan is defined, the application currently runs a "dummy" ActionPlan consisting of a single step where modules with the command registered are all run in parallel.</p>
<p>Action Plans allow for much finer-grained control over the execution of a command within an application, allowing for modules that have dependencies on one another to execute their commands correctly. It also introduces parallelization of command execution within each step, which helps with certain time-consuming module commands (e.g. configuring hardware on a link). The current implmentation uses std::future objects and a catch-all threading pattern to ensure that errors executing steps within an action plan do not lead to program crashes.</p>
<h1><a class="anchor" id="autotoc_md445"></a>
Defining an ActionPlan</h1>
<p>ActionPlans are defined in configuration using these objects:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">class</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ActionPlan&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;A set of parallel steps for an application to carry out a command&quot;</span>&gt;</div>
<div class="line"> &lt;<span class="keywordtype">attribute</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;execution_policy&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;enum&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;How the application should execute steps of the action plan&quot;</span> <span class="keyword">range</span>=<span class="stringliteral">&quot;modules-in-parallel,modules-in-series&quot;</span> <span class="keyword">init-value</span>=<span class="stringliteral">&quot;modules-in-parallel&quot;</span>/&gt;</div>
<div class="line"> &lt;<span class="keywordtype">relationship</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;command&quot;</span> <span class="keyword">class-type</span>=<span class="stringliteral">&quot;FSMCommand&quot;</span> <span class="keyword">low-cc</span>=<span class="stringliteral">&quot;one&quot;</span> <span class="keyword">high-cc</span>=<span class="stringliteral">&quot;one&quot;</span> <span class="keyword">is-composite</span>=<span class="stringliteral">&quot;no&quot;</span> <span class="keyword">is-exclusive</span>=<span class="stringliteral">&quot;no&quot;</span> <span class="keyword">is-dependent</span>=<span class="stringliteral">&quot;no&quot;</span>/&gt;</div>
<div class="line"> &lt;<span class="keywordtype">relationship</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;steps&quot;</span> <span class="keyword">class-type</span>=<span class="stringliteral">&quot;DaqModulesGroup&quot;</span> <span class="keyword">low-cc</span>=<span class="stringliteral">&quot;zero&quot;</span> <span class="keyword">high-cc</span>=<span class="stringliteral">&quot;many&quot;</span> <span class="keyword">is-composite</span>=<span class="stringliteral">&quot;no&quot;</span> <span class="keyword">is-exclusive</span>=<span class="stringliteral">&quot;no&quot;</span> <span class="keyword">is-dependent</span>=<span class="stringliteral">&quot;no&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">class</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">class</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DaqModulesGroup&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Represents a group of DAQ Modules that can run commands in parallel as one of the steps of an ActionPlan.&quot;</span> <span class="keyword">is-abstract</span>=<span class="stringliteral">&quot;yes&quot;</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">class</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">class</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DaqModulesGroupById&quot;</span>&gt;</div>
<div class="line"> &lt;<span class="keywordtype">superclass</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DaqModulesGroup&quot;</span>/&gt;</div>
<div class="line"> &lt;<span class="keywordtype">relationship</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;modules&quot;</span> <span class="keyword">class-type</span>=<span class="stringliteral">&quot;DaqModule&quot;</span> <span class="keyword">low-cc</span>=<span class="stringliteral">&quot;one&quot;</span> <span class="keyword">high-cc</span>=<span class="stringliteral">&quot;many&quot;</span> <span class="keyword">is-composite</span>=<span class="stringliteral">&quot;no&quot;</span> <span class="keyword">is-exclusive</span>=<span class="stringliteral">&quot;no&quot;</span> <span class="keyword">is-dependent</span>=<span class="stringliteral">&quot;no&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">class</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">class</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DaqModulesGroupByType&quot;</span>&gt;</div>
<div class="line"> &lt;<span class="keywordtype">superclass</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DaqModulesGroup&quot;</span>/&gt;</div>
<div class="line"> &lt;<span class="keywordtype">attribute</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;modules&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;class&quot;</span> <span class="keyword">is-multi-value</span>=<span class="stringliteral">&quot;yes&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">class</span>&gt;</div>
</div><!-- fragment --><ol type="1">
<li>ActionPlan relates a set of DAQModule groups to a FSMCommand instance.</li>
</ol>
<ol type="1">
<li>DAQModules can be grouped by type (C++ class) or by Id (module instance reference)</li>
</ol>
<ol type="1">
<li>ActionPlan has a "execution_policy" attribute which sets whether the groups should execute the command in parallel or in series.</li>
</ol>
<p>ActionPlans are validated by the application to ensure that every module type has registered methods corresponding to the command linked to the ActionPlan, and that only one ActionPlan is linked to the application for a given command. Also, SmartDaqApplications are only allowed to use ActionPlans which group modules by type, so the application validates that all ActionPlan steps are of type DaqModulesGroupByType in that case. Note that FSMCommand objects are usually defined by the CCM and included in a fsm.data.xml OKS database.</p>
<h2><a class="anchor" id="autotoc_md446"></a>
Example test/config/appfwk.data.xml</h2>
<p>The DAQModuleManager_test unit test defines several ActionPlans used within the test. For example, the "do_stuff" action:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">obj</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;FSMCommand&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;stuff&quot;</span>&gt;</div>
<div class="line"> &lt;<span class="keywordtype">attr</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;cmd&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;string&quot;</span> <span class="keyword">val</span>=<span class="stringliteral">&quot;stuff&quot;</span>/&gt;</div>
<div class="line"> &lt;<span class="keywordtype">attr</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;optional&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;bool&quot;</span> <span class="keyword">val</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">obj</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">obj</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;ActionPlan&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;stuff&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">rel</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;fsm&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;FSMCommand&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;stuff&quot;</span>/&gt;</div>
<div class="line"> &lt;<span class="keywordtype">rel</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;steps&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">ref</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;DaqModulesGroupByType&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;dummymodules_type_group&quot;</span>/&gt;</div>
<div class="line"> &lt;/<span class="keywordtype">rel</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">obj</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">obj</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;DaqModulesGroupByType&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;dummymodules_type_group&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">attr</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;modules&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;class&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">data</span> <span class="keyword">val</span>=<span class="stringliteral">&quot;DummyModule&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">attr</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">obj</span>&gt;</div>
</div><!-- fragment --><p>Here, the FSMCommand is defined in the file because it is a non-standard command used for the purposes of this unit test. Normally, the FSMCommand instance would not be defined in the same location as the ActionPlan that uses it.</p>
<p>The ActionPlans are associated with the Application instance as follows:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">obj</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;DaqApplication&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;TestApp&quot;</span>&gt;</div>
<div class="line"> &lt;<span class="keywordtype">attr</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;application_name&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;string&quot;</span> <span class="keyword">val</span>=<span class="stringliteral">&quot;daq_application&quot;</span>/&gt;</div>
<div class="line"> &lt;<span class="keywordtype">rel</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;runs_on&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;VirtualHost&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;vlocalhost&quot;</span>/&gt;</div>
<div class="line"> &lt;<span class="keywordtype">rel</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;modules&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">ref</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;DummyModule&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;dummy_module_0&quot;</span>/&gt;</div>
<div class="line"> &lt;/<span class="keywordtype">rel</span>&gt;</div>
<div class="line"> &lt;<span class="keywordtype">rel</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;action_plans&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">ref</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;ActionPlan&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;stuff&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">ref</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;ActionPlan&quot;</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;bad_stuff&quot;</span>/&gt;</div>
<div class="line"> &lt;/<span class="keywordtype">rel</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">obj</span>&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md447"></a>
Notes</h1>
<ul>
<li>DAQModules register their action methods in the same way as before, however the specification of valid states for an action has been removed</li>
<li>ActionPlans refer to FSMCommand objects as defined by the CCM. New FSMCommands may be added, but should be integrated into the state machine in consultation with CCM experts. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 24 2024 for DUNE-DAQ by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
